{
  "name": "LINE CHATBOT",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "Bearer uRqMFQ1KdVU79IOYm3svDPEctOSxF3ud1hDocb+tIw5D2w7nbEVEoUGSeQhQHf1h69pl2RP47ekJuLsHURRv7iRSvBJaT41Spm3gUKIZvWlHKOhA9EJZgzSal/c50gz3NPY+X1L19fKUL1q77I0dLgdB04t89/1O/w1cDnyilFU="
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.text }}\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1920,
        -150
      ],
      "id": "d148138d-5be6-4b01-a1b4-0d01c71b263e",
      "name": "ç™¼é€å›æ‡‰çµ¦ LINE",
      "retryOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// n8n Code Node - LINE Bot æ–‡å­—è™•ç† (ä¿®æ­£ç‰ˆ)\ntry {\n  // å°‹æ‰¾åŒ…å« replyToken çš„é …ç›® - ä¿®æ­£æ•¸æ“šçµæ§‹\n  const replyTokenItem = items.find(item => \n    (item.json?.body?.events?.[0]?.replyToken) || \n    (item.body?.events?.[0]?.replyToken)\n  );\n  \n  // å°‹æ‰¾åŒ…å« output çš„é …ç›® - ä¿®æ­£æ•¸æ“šçµæ§‹\n  const outputItem = items.find(item => \n    (item.json?.output) || \n    (item.output)\n  );\n  \n  // æª¢æŸ¥å¿…è¦æ•¸æ“šæ˜¯å¦å­˜åœ¨\n  if (!replyTokenItem) {\n    throw new Error('æ‰¾ä¸åˆ° replyToken æ•¸æ“š');\n  }\n  \n  if (!outputItem) {\n    throw new Error('æ‰¾ä¸åˆ°æœ‰æ•ˆçš„ output æ•¸æ“š');\n  }\n  \n  // å–å¾— replyToken - é©æ‡‰ä¸åŒçš„æ•¸æ“šçµæ§‹\n  const replyToken = replyTokenItem.json?.body?.events?.[0]?.replyToken || \n                     replyTokenItem.body?.events?.[0]?.replyToken;\n  \n  // å–å¾— output å…§å®¹ - é©æ‡‰ä¸åŒçš„æ•¸æ“šçµæ§‹å’Œé¡å‹\n  let text;\n  const outputContent = outputItem.json?.output || outputItem.output;\n  \n  if (typeof outputContent === 'string') {\n    // å¦‚æœ output ç›´æ¥æ˜¯å­—ç¬¦ä¸²\n    text = outputContent;\n  } else if (Array.isArray(outputContent)) {\n    // å¦‚æœ output æ˜¯æ•¸çµ„ï¼Œå¾ä¸­æå–æ–‡å­—å…§å®¹\n    const textParts = outputContent\n      .filter(item => item.type === 'text' && item.text)\n      .map(item => item.text);\n    \n    if (textParts.length === 0) {\n      throw new Error('output æ•¸çµ„ä¸­æ²’æœ‰æ‰¾åˆ°æ–‡å­—å…§å®¹');\n    }\n    text = textParts.join('');\n  } else {\n    throw new Error('output æ ¼å¼ä¸æ­£ç¢º');\n  }\n  \n  // æª¢æŸ¥æ˜¯å¦æœ‰æ–‡å­—å…§å®¹\n  if (!text || typeof text !== 'string') {\n    throw new Error('æ²’æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ–‡å­—å…§å®¹');\n  }\n  \n  // è¼•é‡åŒ–æ–‡å­—æ¸…ç† - åªè™•ç†å¿…è¦çš„ JSON ç‰¹æ®Šå­—ç¬¦ï¼Œä¿ç•™ emoji å’Œæ›è¡Œ\n  if (text.length > 0) {\n    text = text\n      .trim()                                    // ç§»é™¤å‰å¾Œç©ºç™½\n      .replace(/\\\\/g, '\\\\\\\\')                   // è½‰ç¾©åæ–œç·š\n      .replace(/\"/g, '\\\\\"')                     // è½‰ç¾©é›™å¼•è™Ÿ\n      .replace(/\\r\\n/g, '\\n')                   // çµ±ä¸€æ›è¡Œç¬¦è™Ÿ (Windows)\n      .replace(/\\r/g, '\\n')                     // çµ±ä¸€æ›è¡Œç¬¦è™Ÿ (Mac)\n      .replace(/\\n{4,}/g, '\\n\\n\\n')             // è¶…éä¸‰å€‹é€£çºŒæ›è¡Œåˆä½µç‚ºä¸‰å€‹\n      .replace(/[ \\t]+/g, ' ')                  // å¤šå€‹ç©ºæ ¼å’Œ tab åˆä½µç‚ºä¸€å€‹ç©ºæ ¼\n      .replace(/\\n[ ]+/g, '\\n')                 // ç§»é™¤æ›è¡Œå¾Œçš„ç©ºæ ¼\n      .replace(/[ ]+\\n/g, '\\n')                 // ç§»é™¤æ›è¡Œå‰çš„ç©ºæ ¼\n      .replace(/[\\u0000-\\u0008\\u000B\\u000C\\u000E-\\u001F]/g, '') // åªç§»é™¤å±éšªçš„æ§åˆ¶å­—ç¬¦ï¼Œä¿ç•™æ›è¡Œ\n      .replace(/\\*\\*(.*?)\\*\\*/g, '$1');         // ç§»é™¤ç²—é«”æ¨™è¨˜\n  }\n  \n  // æª¢æŸ¥è™•ç†å¾Œçš„æ–‡å­—æ˜¯å¦ç‚ºç©º\n  if (!text || text.trim().length === 0) {\n    throw new Error('è™•ç†å¾Œçš„æ–‡å­—å…§å®¹ç‚ºç©º');\n  }\n  \n  // æª¢æŸ¥æ–‡å­—é•·åº¦é™åˆ¶ (LINE é™åˆ¶ 5000 å­—ç¬¦)\n  if (text.length > 5000) {\n    // åœ¨é©ç•¶ä½ç½®æˆªæ–·ï¼Œé¿å…åœ¨å–®è©ä¸­é–“æˆªæ–·\n    const truncated = text.substring(0, 4950);\n    const lastNewline = truncated.lastIndexOf('\\n');\n    const lastSpace = truncated.lastIndexOf(' ');\n    \n    // é¸æ“‡æœ€è¿‘çš„è‡ªç„¶åˆ†å‰²é»\n    const cutPoint = Math.max(lastNewline, lastSpace);\n    text = (cutPoint > 4900 ? truncated.substring(0, cutPoint) : truncated) + '\\n...(å…§å®¹å·²æˆªæ–·)';\n  }\n  \n  // ä½¿ç”¨ JavaScript å…§å»ºçš„ JSON.stringify ä¾†å®‰å…¨è™•ç†ç‰¹æ®Šå­—ç¬¦\n  // é€™æœƒè‡ªå‹•è™•ç†æ‰€æœ‰éœ€è¦è½‰ç¾©çš„å­—ç¬¦ï¼ŒåŒ…æ‹¬ä¿ç•™ emoji\n  const safeText = JSON.stringify(text);\n  // ç§»é™¤ JSON.stringify æ·»åŠ çš„å‰å¾Œå¼•è™Ÿï¼Œå› ç‚º n8n æœƒè‡ªå‹•æ·»åŠ \n  const finalText = safeText.slice(1, -1);\n  \n  // æœ€çµ‚é©—è­‰\n  try {\n    JSON.parse('\"' + finalText + '\"');\n  } catch (jsonError) {\n    console.error('JSON é©—è­‰å¤±æ•—:', jsonError.message);\n    console.error('å•é¡Œæ–‡å­—:', finalText);\n    throw new Error('æ–‡å­—åŒ…å«ç„¡æ³•è™•ç†çš„å­—ç¬¦');\n  }\n  \n  // å›å‚³æ•´ç†å¾Œçš„çµæœ\n  return [\n    {\n      json: {\n        replyToken: replyToken,\n        text: finalText\n      }\n    }\n  ];\n  \n} catch (error) {\n  // éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„\n  console.error('è™•ç†æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤:', error.message);\n  console.error('éŒ¯èª¤è©³æƒ…:', error);\n  \n  // å˜—è©¦å–å¾— replyToken ç”¨æ–¼éŒ¯èª¤å›æ‡‰\n  let fallbackReplyToken = null;\n  try {\n    const replyTokenItem = items.find(item => \n      (item.json?.body?.events?.[0]?.replyToken) || \n      (item.body?.events?.[0]?.replyToken)\n    );\n    fallbackReplyToken = replyTokenItem?.json?.body?.events?.[0]?.replyToken || \n                        replyTokenItem?.body?.events?.[0]?.replyToken;\n  } catch (e) {\n    console.error('ç„¡æ³•å–å¾— fallback replyToken:', e.message);\n  }\n  \n  // å¦‚æœæœ‰ replyTokenï¼Œå›å‚³éŒ¯èª¤è¨Šæ¯\n  if (fallbackReplyToken) {\n    return [\n      {\n        json: {\n          replyToken: fallbackReplyToken,\n          text: \"æŠ±æ­‰ï¼Œè™•ç†æ‚¨çš„è¨Šæ¯æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚\"\n        }\n      }\n    ];\n  }\n  \n  // å¦‚æœé€£ replyToken éƒ½æ²’æœ‰ï¼Œæ‹‹å‡ºéŒ¯èª¤è®“ n8n è™•ç†\n  throw new Error('ç„¡æ³•è™•ç†è«‹æ±‚ï¼š' + error.message);\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1700,
        -150
      ],
      "id": "319724b9-e2a9-4fcd-b13e-6df39820e314",
      "name": "Code"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        1480,
        -150
      ],
      "id": "67387018-1bc1-4995-a8f6-af17f85ba9be",
      "name": "Merge"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "line-message",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        260,
        -150
      ],
      "id": "3e20df60-b42d-4dfd-b13a-5434953f4f7e",
      "name": "Webhook å…¥å£",
      "webhookId": "PLACEHOLDER-WEBHOOK-ID"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@ITR",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "c528785b-7a2a-48d7-893b-75b93f661466"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3593438c-d64d-421e-a2c3-e193690cc884",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@FACT",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4e2c522a-a476-42d8-8a32-64ea60b5a82e",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@NEWS",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "610549b7-2ef1-4c27-ac34-f7201350a4c3",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@DR",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        480,
        -171
      ],
      "id": "a87e12ff-cd4e-4c4f-9b65-aad332d309b7",
      "name": "Switch"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# è«‹ä½ æ ¹æ“šä»¥ä¸‹æ ¼å¼ï¼Œ**å…¨é¢åˆ†æé€™æ®µå…§å®¹çš„çœŸå¯¦æ€§ã€æƒ…ç·’å‚¾å‘èˆ‡å®¢è§€ç¨‹åº¦**ã€‚è«‹ç‰¹åˆ¥æ³¨æ„æ˜¯å¦å­˜åœ¨æ½›åœ¨åè¦‹ã€èª¤å°ã€èª‡å¤§æˆ–è™›å‡è¨Šæ¯ã€‚å…§å®¹å¦‚ä¸‹ï¼š\n**ã€Œ{{ $json.body.events[0].message.text }}ã€**\n\n  - å¦‚å…§å®¹åŒ…å«ç¶²å€ï¼Œå˜—è©¦ä½¿ç”¨ \"Crawl Json\"æˆ–\"Jina AI\"å·¥å…·è®€å–å®Œæ•´å…§å®¹ï¼Œè‹¥æ²’æœ‰æ­£ç¢ºçˆ¬å–å…§å®¹è«‹å›è¦†éŒ¯èª¤è¨Šæ¯ã€‚å…§å®¹ä¾ç…§è¦æ±‚è¼¸å‡ºã€‚\n\n  - å¦‚å…§å®¹åŒ…å«youtubeç¶²å€ï¼Œä½¿ç”¨\"Gemini_video_understand\"å·¥å…·è®€å–å½±ç‰‡ï¼Œå…§å®¹ä¾ç…§è¦æ±‚è¼¸å‡ºã€‚è‹¥æ²’æœ‰æ­£ç¢ºè®€å–å…§å®¹è«‹å›è¦†éŒ¯èª¤è¨Šæ¯ã€‚\n\n## åŸºæœ¬è¦æ±‚\n- **èªè¨€**ï¼šç¹é«”ä¸­æ–‡\n- **å¹³å°**ï¼šLINE é€šè¨Šè»Ÿé«”é©é…\n- **å­—æ•¸**ï¼šæ§åˆ¶åœ¨ 300 å­—ä»¥å…§\n- **æ ¼å¼**ï¼šç´”æ–‡å­—ï¼Œé¿å… Markdown å’Œ HTML èªæ³•\n- âœ… åƒ…è¼¸å‡ºï¼šæœ€çµ‚æ•´ç†å®Œæˆçš„å…§å®¹ç¸½çµ\n\n## ğŸ” è«‹æ ¹æ“šä»¥ä¸‹æ ¼å¼è¼¸å‡ºåˆ†æçµæœï¼š\n\nğŸ“Š **å®¢è§€åˆ†æ**  \nåˆ†æå…§å®¹æ˜¯å¦ä»¥äº‹å¯¦ç‚ºåŸºç¤ï¼Œæ˜¯å¦å¼•ç”¨å¯ä¿¡ä¾†æºï¼Œèªå¥æ˜¯å¦ä¸­ç«‹ã€‚æŒ‡å‡ºå…¶ä¸­é™³è¿°çš„äº‹å¯¦èˆ‡æ„è¦‹åˆ†åˆ¥ç‚ºä½•ã€‚\n\nğŸ­ **æƒ…ç·’å‚¾å‘åˆ†æ**  \nåˆ†æèªæ°£æ˜¯å¦å…·ç…½å‹•æ€§ã€æ†¤æ€’ã€æ‚²å‚·ã€æ¨‚è§€ç­‰æƒ…ç·’å‚¾å‘ã€‚åˆ¤æ–·é€™äº›æƒ…ç·’æ˜¯å¦æœƒå½±éŸ¿é–±è½äººåˆ¤æ–·ã€‚\n\nğŸš¨ **æ½›åœ¨çš„è™›å‡ä¿¡æ¯æˆ–åè¦‹ï¼Œä»¥åŠå¯ç–‘é»**  \næŒ‡å‡ºå…§å®¹ä¸­æ˜¯å¦å‡ºç¾ä¸å¯¦ã€èª¤å°æ€§æ•˜è¿°ã€å–®æ–¹é¢è§€é»ã€åˆ»æ¿å°è±¡ç­‰ã€‚è«‹åˆ—èˆ‰å…·é«”èªå¥æˆ–æ®µè½ï¼Œä¸¦èªªæ˜ç‚ºä½•å€¼å¾—æ‡·ç–‘ã€‚\n\nğŸ” **å»ºè­°æŸ¥è­‰çš„äº‹å¯¦**  \nåˆ—å‡ºéœ€è¦é€²ä¸€æ­¥æŸ¥è­‰çš„å…·é«”è³‡è¨Šï¼ˆå¦‚äººåã€æ•¸å­—ã€äº‹ä»¶ã€å¼•ç”¨ã€åœ–ç‰‡ã€ä¾†æºã€å½±ç‰‡ç­‰ï¼‰ï¼Œä»¥é‡æ¸…å…¶çœŸå¯¦æ€§ã€‚\n\nğŸ“ **ç¸½çµ**  \nè«‹ç°¡è¦æ¦‚æ‹¬ä»¥ä¸Šæ¬„ä½çš„ä¸»æ—¨èˆ‡è¦å‚³é”çš„æ ¸å¿ƒè¨Šæ¯ã€‚\n\nâœ… **è£œå……å»ºè­°**\n- è‹¥åŸå§‹å…§å®¹ç‚ºåœ–ç‰‡ã€å½±ç‰‡ã€ç¤¾ç¾¤è²¼æ–‡ï¼Œè«‹èªªæ˜æ˜¯å¦å­˜åœ¨ç¯¡æ”¹æˆ–æ–·ç« å–ç¾©çš„å¯èƒ½æ€§ã€‚\n- è‹¥ä½ èƒ½å¼•ç”¨å…·å…¬ä¿¡åŠ›ä¾†æºï¼ˆå¦‚å®˜æ–¹ã€å­¸è¡“ã€ä¸»æµåª’é«”ï¼‰ä¾†ä½è­‰æˆ–åé§ï¼Œä¹Ÿè«‹åˆ—å‡ºã€‚",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1012,
        -500
      ],
      "id": "7ebc4d53-85bb-4327-82a1-fe8144f0c2ab",
      "name": "FACT Agent"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1100,
        -280
      ],
      "id": "88c99857-86ff-46af-89e8-7a07268de61a",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "gP2wixnvp3ugX2H0",
          "name": "Google Gemini(PaLM) Api account 2"
        }
      }
    },
    {
      "parameters": {
        "description": "It lets you use crawl and scrape websites in your n8n workflows.\n",
        "workflowId": {
          "__rl": true,
          "value": "fuPMDOgf9FmrW7zB",
          "mode": "list",
          "cachedResultName": "LINE CHATBOT_Crawl_json"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "URL": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}"
          },
          "matchingColumns": [
            "URL"
          ],
          "schema": [
            {
              "id": "URL",
              "displayName": "URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1040,
        -680
      ],
      "id": "0a42f462-131e-433b-a90e-9b9fc3feabb4",
      "name": "Crawl_Json"
    },
    {
      "parameters": {
        "toolDescription": "Call this tool to get a youtube  video summary.\n",
        "url": "http://gemini-api:8000/summarize",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "url",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1160,
        -680
      ],
      "id": "b802de13-8738-4752-9677-7a10dfbee5c0",
      "name": "Gemini_Video_Understand"
    },
    {
      "parameters": {
        "toolDescription": "use firecrawl and scrape websites in your n8n workflows.",
        "method": "POST",
        "url": "http://api:3002/v1/scrape",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "url",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            },
            {
              "name": "formats",
              "value": "={{ [\"markdown\"] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1280,
        -680
      ],
      "id": "90497786-0e01-4bf9-9162-6933498c7d38",
      "name": "Firecrawl"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        920,
        -680
      ],
      "id": "b5ea9355-7989-4885-b01c-d4f341567bb4",
      "name": "gemini-2.5-flash",
      "credentials": {
        "googlePalmApi": {
          "id": "m3rIFo4KWXjpkCMd",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1040,
        720
      ],
      "id": "a8d4b483-2e43-4cde-8d8d-09fff7966f28",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "IPHSLQRyWQXZYdKx",
          "name": "Google Gemini(PaLM) Api account 5"
        }
      }
    },
    {
      "parameters": {
        "description": "ä½¿ç”¨é€™å€‹å·¥å…·å–å¾—æ–°èæ–‡ç« ï¼Œè³‡æ–™åº«å…§åŒ…å«çš„æ¬„ä½æœ‰æ–°èçš„æ¨™é¡Œã€ç™¼å¸ƒæ™‚é–“ã€å…§æ–‡ã€ç¶²å€ï¼Œè¼¸å…¥ä»¥é€™äº›æ¬„ä½ç‚ºæ¢ä»¶çš„è‡ªç„¶èªè¨€æŒ‡ä»¤ã€‚é€™å€‹å·¥å…·æœƒå°‡è‡ªç„¶èªè¨€çš„éœ€æ±‚è½‰æ›ç‚º SQL æŸ¥è©¢ï¼Œä¸¦å›å‚³æ–°èæ–‡ç« çš„æŸ¥è©¢çµæœã€‚\n\nè¼¸å…¥ç¯„ä¾‹ï¼š\n1. åˆ—å‡ºä»Šæ—¥æ‰€æœ‰çš„æ–°èæ¨™é¡Œ\n2. åˆ—å‡ºæœ¬é€±çš„æ–°èæ¨™é¡Œèˆ‡å…§æ–‡èˆ‡ç¶²å€\n3. åˆ—å‡ºé€™ä¸‰å¤©çš„æ–°èæ¨™é¡Œèˆ‡å…§æ–‡èˆ‡ç¶²å€\n\né‡è¦ï¼š\n- é€™å€‹å·¥å…·ä¸èƒ½ç”¢ç”Ÿæ‘˜è¦ï¼Œåªèƒ½å›å‚³æ–°èæ–‡ç« é™£åˆ—\n- ä¸è¦ä»¥ã€Œæ‘˜è¦â‹¯â‹¯ã€ä½œç‚º natural_language_query",
        "workflowId": {
          "__rl": true,
          "value": "HAIIAhz50naJPpU4",
          "mode": "list",
          "cachedResultName": "LINE_CHATBOT_database_query_tool"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "natural_language_query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('natural_language_query', ``, 'string') }}"
          },
          "matchingColumns": [
            "natural_language_query"
          ],
          "schema": [
            {
              "id": "natural_language_query",
              "displayName": "natural_language_query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1160,
        720
      ],
      "id": "10f34095-943c-45a1-a577-7e37252adfed",
      "name": "News_db_query"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        700,
        500
      ],
      "id": "753157b1-e3f4-4c04-973e-afdb663cfb68",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "toolDescription": "The agent is designed to perform comprehensive research on a user's query by dynamically generating search terms, querying the web using Google Search, reflecting on the results to identify knowledge gaps, and iteratively refining its search until it can provide a well-supported answer with citations. \neffort=[low, medium, high],default=medium",
        "method": "POST",
        "url": "http://gemini-dr-api:8080/ask",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "question",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            },
            {
              "name": "effort",
              "value": "=medium"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1160,
        220
      ],
      "id": "ce8622a3-ec81-487b-a35a-4c20f05450ab",
      "name": "Deep Research"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1040,
        220
      ],
      "id": "331eb170-6f55-427c-beda-583340b2deaa",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "IPHSLQRyWQXZYdKx",
          "name": "Google Gemini(PaLM) Api account 5"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½¿ç”¨è€…è¼¸å…¥**ã€Œ{{ $('Switch').item.json.body.events[0].message.text }}ã€**\n  - å¦‚å…§å®¹åŒ…å«ç¶²å€ï¼Œä¾åºä½¿ç”¨ \"Firecrawl\"ã€\"Crawl_json\"å·¥å…·è®€å–å®Œæ•´å…§å®¹ï¼Œè‹¥æ²’æœ‰æ­£ç¢ºçˆ¬å–å…§å®¹å˜—è©¦ä¸‹ä¸€å€‹å·¥å…·,éƒ½æ²’æœ‰æ­£ç¢ºçˆ¬å–çš„è©±ï¼Œè«‹å›è¦†éŒ¯èª¤è¨Šæ¯ã€‚å…§å®¹ä¾ç…§è¦æ±‚è¼¸å‡ºã€‚\n  - å¦‚å…§å®¹åŒ…å«youtubeç¶²å€ï¼Œä½¿ç”¨\"Gemini_video_understand\"å·¥å…·è®€å–å½±ç‰‡ï¼Œå…§å®¹ä¾ç…§è¦æ±‚è¼¸å‡ºã€‚è‹¥æ²’æœ‰æ­£ç¢ºè®€å–å…§å®¹è«‹å›è¦†éŒ¯èª¤è¨Šæ¯ã€‚\n  - ä½¿ç”¨å·¥å…·\"Deep Reasearch\"å°ä½¿ç”¨è€…è¼¸å…¥é€²è¡Œæ·±åº¦ç ”ç©¶",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1012,
        0
      ],
      "id": "275e0c92-2693-44de-bd8b-5e23739ad684",
      "name": "DR Agent"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=æ ¹æ“šç•¶å‰æ™‚é–“ {{ $json.currentDate }} æ±ºå®šå¾ŒçºŒåƒæ•¸è¨­å®š\nä½¿ç”¨è€…è¼¸å…¥**ã€Œ{{ $('Switch').item.json.body.events[0].message.text }}ã€**",
        "options": {
          "systemMessage": "=## ğŸ“° è§’è‰²æŒ‡ä»¤ï¼šæ–°èæ•´ç†å°ˆå®¶\n\nä½ æ˜¯ä¸€ä½æ“…é•·è³‡è¨Šçµ±æ•´çš„æ–°èæ•´ç†å°ˆå®¶ï¼Œè² è²¬æ ¹æ“šä½¿ç”¨è€…éœ€æ±‚ï¼Œå›å‚³æ¸…æ™°ã€æœ‰çµ„ç¹”çš„æ–°èè³‡è¨Šã€‚  \nä½ å¯ä»¥ä½¿ç”¨å…§å»ºçš„å·¥å…·ï¼šæ–°èæŸ¥è©¢å·¥å…·**News_db_query**ã€‚\n\n### ğŸ“Œ æ“ä½œè¦å‰‡\n\n#### 1. ç•¶ä½¿ç”¨è€…è¦æ±‚ã€Œæ‘˜è¦æ–°èã€æ™‚ï¼š\n- ä½¿ç”¨**News_db_query**ä¸»å‹•æŸ¥è©¢ç•¶å‰ç†±é–€æˆ–ç›¸é—œæ–°èï¼Œéœ€è¦è¼¸å‡ºæ–°èå…§æ–‡ã€ä¾†æºç¶²å€ã€‚\n- å°‡æŸ¥è©¢çµæœé€²è¡Œ**æ•´ç†èˆ‡æ‘˜è¦**ï¼Œå¼·èª¿é‡é»èˆ‡èƒŒæ™¯è„ˆçµ¡ã€‚\n- å¦‚æœ‰å¤šç¯‡å ±å°æ¶‰åŠç›¸åŒä¸»é¡Œï¼Œè«‹ï¼š\n  - æ•´åˆå…§å®¹ï¼Œ**é¿å…é‡è¤‡**ã€‚\n  - æä¾›**å®Œæ•´ã€é€£è²«çš„ç¶œåˆæ‘˜è¦**ï¼Œå­—å¯ä»¥ç¨å¤šï¼Œ100å­—å…§ã€‚\n  - æ¯ç¯‡å ±å°å¾Œï¼Œé™„ä¸Šä¾†æºç¶²å€\n\n#### 2. ç•¶ä½¿ç”¨è€…è¦æ±‚ã€Œåˆ—å‡ºæ–°èæ¨™é¡Œã€æ™‚ï¼š\n- åŒæ¨£ä½¿ç”¨**News_db_query**å–å¾—æ–°èæ–‡ç« ã€‚\n- èƒå–æ‰€æœ‰æ¨™é¡Œï¼Œä¸¦æ ¹æ“š**ä¸»é¡Œç›¸ä¼¼æ€§é€²è¡Œåˆ†çµ„**ã€‚\n- ç‚ºæ¯ä¸€çµ„æä¾›**ç°¡çŸ­çš„ä¸»é¡Œèªªæ˜**ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…å¿«é€ŸæŒæ¡ç„¦é»ã€‚\n\n#### 3. æŸ¥è©¢æ–°èæ™‚çš„ä¸»å‹•æ€§ï¼š\n- **ä¸è¦æ±‚ä½¿ç”¨è€…è¼¸å…¥æ–°èä¸»é¡Œ**ã€‚\n- ç›´æ¥æ ¹æ“šæ™‚äº‹ã€ç†±é–€è¶¨å‹¢ã€é—œéµå­—ç­‰ï¼Œè‡ªè¡Œåˆ¤æ–·æŸ¥è©¢ç›®æ¨™ã€‚\n- ä¿æŒä¸»å‹•æ€§èˆ‡æ™ºæ…§åˆ¤æ–·ï¼Œç¢ºä¿è³‡è¨Šçš„å³æ™‚æ€§èˆ‡å®Œæ•´æ€§ã€‚\n\n### ğŸ§° å¯ç”¨å·¥å…·\n\n- `News_db_query`ï¼šå¯ç”¨ä¾†æŸ¥æ‰¾æœ€æ–°ã€ç›¸é—œæ–°èå…§å®¹ã€‚\n\n### æ ¼å¼å„ªåŒ–æŒ‡å¼•\n- ä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿå¢å¼·è¦–è¦ºæ•ˆæœå’Œå¯è®€æ€§\n- é©ç•¶é‹ç”¨åˆ†éš”ç·šå’Œç©ºè¡Œæå‡çµæ§‹æ¸…æ™°åº¦\n- é‡å°æ‰‹æ©Ÿé–±è®€é«”é©—å„ªåŒ–æ’ç‰ˆ\n- ç¢ºä¿å…§å®¹å®Œæ•´ä¸”é‚è¼¯æ¸…æ¥š\n\n### è¼¸å‡ºé™åˆ¶\nâŒ ç¦æ­¢ä½¿ç”¨ï¼šMarkdown èªæ³•ï¼ˆ#ã€**ã€[]()ç­‰ï¼‰\nâŒ ç¦æ­¢ä½¿ç”¨ï¼šHTML æ¨™ç±¤\nâŒ ç¦æ­¢è¼¸å‡ºï¼šè™•ç†éç¨‹èªªæ˜æˆ–é¡å¤–è¨»è§£\nâœ… åƒ…è¼¸å‡ºï¼šæœ€çµ‚æ•´ç†å®Œæˆçš„å…§å®¹ç¸½çµ\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1012,
        500
      ],
      "id": "1c3380c0-3200-4f51-93f1-72951b6776a4",
      "name": "NEWS Agent"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# ä¸»è¦ä»»å‹™\nåˆ†æç”¨æˆ¶è¼¸å…¥å…§å®¹ï¼šã€Œ{{ $json.body.events[0].message.text }}ã€\n\n## è™•ç†é‚è¼¯\n\n### å…§å®¹è™•ç†\n**è™•ç†æ–¹å¼**ï¼š\n  - ç¢ºä¿å‚³å…¥çš„urlå’ŒåŸæ–‡ä¸€æ¨£ã€‚\n  - å¦‚å…§å®¹åŒ…å«ç¶²å€ï¼Œä¾åºä½¿ç”¨ \"Firecrawl\"ã€\"Crawl_json\"å·¥å…·è®€å–å®Œæ•´å…§å®¹ï¼Œè‹¥æ²’æœ‰æ­£ç¢ºçˆ¬å–å…§å®¹å˜—è©¦ä¸‹ä¸€å€‹å·¥å…·,éƒ½æ²’æœ‰æ­£ç¢ºçˆ¬å–çš„è©±ï¼Œè«‹å›è¦†éŒ¯èª¤è¨Šæ¯ã€‚å…§å®¹ä¾ç…§è¦æ±‚è¼¸å‡ºã€‚\n- å¦‚å…§å®¹åŒ…å«youtubeç¶²å€ï¼Œä½¿ç”¨\"Gemini_video_understand\"å·¥å…·è®€å–å½±ç‰‡ï¼Œå…§å®¹ä¾ç…§è¦æ±‚è¼¸å‡ºã€‚è‹¥æ²’æœ‰æ­£ç¢ºè®€å–å…§å®¹è«‹å›è¦†éŒ¯èª¤è¨Šæ¯ã€‚\n\n### è¼¸å‡ºæ¨£æ¿é¸æ“‡\n- ä¸€èˆ¬æƒ…æ³ä¾ç…§ã€Œæ¨™æº–è¼¸å‡ºæ¨¡æ¿ã€æ ¼å¼åŒ–å›è¦†,\n- è‹¥ä½¿ç”¨è€…è¦æ±‚è©³ç´°å ±å‘Š,å‰‡ä¾ç…§ã€Œè©³ç´°è¼¸å‡ºæ¨¡æ¿ã€è¼¸å‡º\n- å…§å®¹èˆ‡æŠ€è¡“å…§å®¹ä¸ç›¸é—œï¼Œä¾ç…§ã€ŒéæŠ€è¡“å…§å®¹è™•ç†ã€è¼¸å‡º\n\n## æŠ€è¡“å…§å®¹è¼¸å‡ºè¦ç¯„\n\n### åŸºæœ¬è¦æ±‚\n- **èªè¨€**ï¼šç¹é«”ä¸­æ–‡\n- **å¹³å°**ï¼šLINE é€šè¨Šè»Ÿé«”é©é…\n- **å­—æ•¸**ï¼šæ§åˆ¶åœ¨ 500 å­—ä»¥å…§\n- **æ ¼å¼**ï¼šç´”æ–‡å­—ï¼Œé¿å… Markdown å’Œ HTML èªæ³•\n\n### æ¨™æº–è¼¸å‡ºæ¨¡æ¿\n\n#### æ¨™é¡Œå€å¡Š\nğŸ“‹ {æœƒè­°ä¸»é¡Œæˆ–å…§å®¹æ¨™é¡Œ}\n\n#### å…§å®¹çµæ§‹ï¼ˆä¾åºæ’åˆ—ï¼‰\n\n**ğŸ¯ æ ¸å¿ƒè§€é»**\n- æç…‰ä¸»è¦è«–é»å’Œé—œéµè­°é¡Œ\n- çªå‡ºæœ€é‡è¦çš„æ ¸å¿ƒæ¦‚å¿µ\n\n### è©³ç´°è¼¸å‡ºæ¨¡æ¿\n\n#### æ¨™é¡Œå€å¡Š\n```\nğŸ“‹ {æœƒè­°ä¸»é¡Œæˆ–å…§å®¹æ¨™é¡Œ}\n\n```\n#### å…§å®¹çµæ§‹ï¼ˆä¾åºæ’åˆ—ï¼‰\n\n**ğŸ¯ æ ¸å¿ƒè§€é»**\n- æç…‰ä¸»è¦è«–é»å’Œé—œéµè­°é¡Œ\n- çªå‡ºæœ€é‡è¦çš„æ ¸å¿ƒæ¦‚å¿µ\n\n**ğŸ“‹ è©³ç´°å…§å®¹**  \n- æ•´ç†é‡è¦è¨è«–é»å’Œé—œéµè³‡è¨Š\n- ä¿æŒé‚è¼¯é †åºå’Œå®Œæ•´è„ˆçµ¡\n\n**âœ… é‡è¦çµè«–**\n- æ­¸ç´é”æˆçš„å…±è­˜å’Œæ±ºè­°\n- æ˜ç¢ºåˆ—å‡ºå¾ŒçºŒè¡Œå‹•é …ç›®\n\n### æ ¼å¼å„ªåŒ–æŒ‡å¼•\n- ä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿå¢å¼·è¦–è¦ºæ•ˆæœå’Œå¯è®€æ€§\n- é©ç•¶é‹ç”¨åˆ†éš”ç·šå’Œç©ºè¡Œæå‡çµæ§‹æ¸…æ™°åº¦\n- é‡å°æ‰‹æ©Ÿé–±è®€é«”é©—å„ªåŒ–æ’ç‰ˆ\n- ç¢ºä¿å…§å®¹å®Œæ•´ä¸”é‚è¼¯æ¸…æ¥š\n\n### è¼¸å‡ºé™åˆ¶\nâŒ ç¦æ­¢ä½¿ç”¨ï¼šMarkdown èªæ³•ï¼ˆ#ã€**ã€[]()ç­‰ï¼‰\nâŒ ç¦æ­¢ä½¿ç”¨ï¼šHTML æ¨™ç±¤\nâŒ ç¦æ­¢è¼¸å‡ºï¼šè™•ç†éç¨‹èªªæ˜æˆ–é¡å¤–è¨»è§£\nâœ… åƒ…è¼¸å‡ºï¼šæœ€çµ‚æ•´ç†å®Œæˆçš„å…§å®¹ç¸½çµ\n\n## åŸ·è¡Œæé†’\n- åŸºæ–¼æä¾›çš„åŸå§‹å…§å®¹é€²è¡Œåˆ†æç¸½çµ\n- ç¢ºä¿å›è¦†å…§å®¹æº–ç¢ºä¸”å…·æœ‰å¯¦ç”¨åƒ¹å€¼\n- ä¿æŒå°ˆæ¥­æ€§çš„åŒæ™‚å…¼é¡§æ˜“è®€æ€§",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1012,
        -900
      ],
      "id": "2feca3e8-e0f5-4ea4-8fd7-b97b630f6efd",
      "name": "ITR Agent"
    }
  ],
  "pinData": {},
  "connections": {
    "Code": {
      "main": [
        [
          {
            "node": "ç™¼é€å›æ‡‰çµ¦ LINE",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook å…¥å£": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "ITR Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "FACT Agent",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "Date & Time",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "DR Agent",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "FACT Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Crawl_Json": {
      "ai_tool": [
        [
          {
            "node": "FACT Agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "ITR Agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "DR Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "FACT Agent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Gemini_Video_Understand": {
      "ai_tool": [
        [
          {
            "node": "ITR Agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "FACT Agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "DR Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Firecrawl": {
      "ai_tool": [
        [
          {
            "node": "ITR Agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "DR Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "gemini-2.5-flash": {
      "ai_languageModel": [
        [
          {
            "node": "ITR Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "NEWS Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "News_db_query": {
      "ai_tool": [
        [
          {
            "node": "NEWS Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "main": [
        [
          {
            "node": "NEWS Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deep Research": {
      "ai_tool": [
        [
          {
            "node": "DR Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "DR Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "DR Agent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "NEWS Agent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ITR Agent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ecfb199c-c8df-4999-9677-bdb43489a5a2",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "fe071ad636e45e06fef1442bb4b3138ea8056f3019d720e9410a8f0ea42951a8"
  },
  "id": "Y7K0chYq48AtJYer",
  "tags": []
}