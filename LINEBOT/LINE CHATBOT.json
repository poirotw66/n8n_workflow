{
  "name": "LINE CHATBOT",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "={{ $env.LINE_CHANNEL_ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.text }}\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2816,
        -64
      ],
      "id": "d148138d-5be6-4b01-a1b4-0d01c71b263e",
      "name": "ç™¼é€å›æ‡‰çµ¦ LINE",
      "retryOnFail": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code Node - LINE Bot æ–‡å­—è™•ç† (ä¿®æ­£ç‰ˆ)\ntry {\n  // å°‹æ‰¾åŒ…å« replyToken çš„é …ç›® - ä¿®æ­£æ•¸æ“šçµæ§‹\n  const replyTokenItem = items.find(item => \n    (item.json?.body?.events?.[0]?.replyToken) || \n    (item.body?.events?.[0]?.replyToken)\n  );\n  \n  // å°‹æ‰¾åŒ…å« output çš„é …ç›® - ä¿®æ­£æ•¸æ“šçµæ§‹\n  const outputItem = items.find(item => \n    (item.json?.output) || \n    (item.output)\n  );\n  \n  // æª¢æŸ¥å¿…è¦æ•¸æ“šæ˜¯å¦å­˜åœ¨\n  if (!replyTokenItem) {\n    throw new Error('æ‰¾ä¸åˆ° replyToken æ•¸æ“š');\n  }\n  \n  if (!outputItem) {\n    throw new Error('æ‰¾ä¸åˆ°æœ‰æ•ˆçš„ output æ•¸æ“š');\n  }\n  \n  // å–å¾— replyToken - é©æ‡‰ä¸åŒçš„æ•¸æ“šçµæ§‹\n  const replyToken = replyTokenItem.json?.body?.events?.[0]?.replyToken || \n                     replyTokenItem.body?.events?.[0]?.replyToken;\n  \n  // å–å¾— output å…§å®¹ - é©æ‡‰ä¸åŒçš„æ•¸æ“šçµæ§‹å’Œé¡å‹\n  let text;\n  const outputContent = outputItem.json?.output || outputItem.output;\n  \n  if (typeof outputContent === 'string') {\n    // å¦‚æœ output ç›´æ¥æ˜¯å­—ç¬¦ä¸²\n    text = outputContent;\n  } else if (Array.isArray(outputContent)) {\n    // å¦‚æœ output æ˜¯æ•¸çµ„ï¼Œå¾ä¸­æå–æ–‡å­—å…§å®¹\n    const textParts = outputContent\n      .filter(item => item.type === 'text' && item.text)\n      .map(item => item.text);\n    \n    if (textParts.length === 0) {\n      throw new Error('output æ•¸çµ„ä¸­æ²’æœ‰æ‰¾åˆ°æ–‡å­—å…§å®¹');\n    }\n    text = textParts.join('');\n  } else {\n    throw new Error('output æ ¼å¼ä¸æ­£ç¢º');\n  }\n  \n  // æª¢æŸ¥æ˜¯å¦æœ‰æ–‡å­—å…§å®¹\n  if (!text || typeof text !== 'string') {\n    throw new Error('æ²’æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ–‡å­—å…§å®¹');\n  }\n  \n  // è¼•é‡åŒ–æ–‡å­—æ¸…ç† - åªè™•ç†å¿…è¦çš„ JSON ç‰¹æ®Šå­—ç¬¦ï¼Œä¿ç•™ emoji å’Œæ›è¡Œ\n  if (text.length > 0) {\n    text = text\n      .trim()                                    // ç§»é™¤å‰å¾Œç©ºç™½\n      .replace(/\\\\/g, '\\\\\\\\')                   // è½‰ç¾©åæ–œç·š\n      .replace(/\"/g, '\\\\\"')                     // è½‰ç¾©é›™å¼•è™Ÿ\n      .replace(/\\r\\n/g, '\\n')                   // çµ±ä¸€æ›è¡Œç¬¦è™Ÿ (Windows)\n      .replace(/\\r/g, '\\n')                     // çµ±ä¸€æ›è¡Œç¬¦è™Ÿ (Mac)\n      .replace(/\\n{4,}/g, '\\n\\n\\n')             // è¶…éä¸‰å€‹é€£çºŒæ›è¡Œåˆä½µç‚ºä¸‰å€‹\n      .replace(/[ \\t]+/g, ' ')                  // å¤šå€‹ç©ºæ ¼å’Œ tab åˆä½µç‚ºä¸€å€‹ç©ºæ ¼\n      .replace(/\\n[ ]+/g, '\\n')                 // ç§»é™¤æ›è¡Œå¾Œçš„ç©ºæ ¼\n      .replace(/[ ]+\\n/g, '\\n')                 // ç§»é™¤æ›è¡Œå‰çš„ç©ºæ ¼\n      .replace(/[\\u0000-\\u0008\\u000B\\u000C\\u000E-\\u001F]/g, '') // åªç§»é™¤å±éšªçš„æ§åˆ¶å­—ç¬¦ï¼Œä¿ç•™æ›è¡Œ\n      .replace(/\\*\\*(.*?)\\*\\*/g, '$1');         // ç§»é™¤ç²—é«”æ¨™è¨˜\n  }\n  \n  // æª¢æŸ¥è™•ç†å¾Œçš„æ–‡å­—æ˜¯å¦ç‚ºç©º\n  if (!text || text.trim().length === 0) {\n    throw new Error('è™•ç†å¾Œçš„æ–‡å­—å…§å®¹ç‚ºç©º');\n  }\n  \n  // æª¢æŸ¥æ–‡å­—é•·åº¦é™åˆ¶ (LINE é™åˆ¶ 5000 å­—ç¬¦)\n  if (text.length > 5000) {\n    // åœ¨é©ç•¶ä½ç½®æˆªæ–·ï¼Œé¿å…åœ¨å–®è©ä¸­é–“æˆªæ–·\n    const truncated = text.substring(0, 4950);\n    const lastNewline = truncated.lastIndexOf('\\n');\n    const lastSpace = truncated.lastIndexOf(' ');\n    \n    // é¸æ“‡æœ€è¿‘çš„è‡ªç„¶åˆ†å‰²é»\n    const cutPoint = Math.max(lastNewline, lastSpace);\n    text = (cutPoint > 4900 ? truncated.substring(0, cutPoint) : truncated) + '\\n...(å…§å®¹å·²æˆªæ–·)';\n  }\n  \n  // ä½¿ç”¨ JavaScript å…§å»ºçš„ JSON.stringify ä¾†å®‰å…¨è™•ç†ç‰¹æ®Šå­—ç¬¦\n  // é€™æœƒè‡ªå‹•è™•ç†æ‰€æœ‰éœ€è¦è½‰ç¾©çš„å­—ç¬¦ï¼ŒåŒ…æ‹¬ä¿ç•™ emoji\n  const safeText = JSON.stringify(text);\n  // ç§»é™¤ JSON.stringify æ·»åŠ çš„å‰å¾Œå¼•è™Ÿï¼Œå› ç‚º n8n æœƒè‡ªå‹•æ·»åŠ \n  const finalText = safeText.slice(1, -1);\n  \n  // æœ€çµ‚é©—è­‰\n  try {\n    JSON.parse('\"' + finalText + '\"');\n  } catch (jsonError) {\n    console.error('JSON é©—è­‰å¤±æ•—:', jsonError.message);\n    console.error('å•é¡Œæ–‡å­—:', finalText);\n    throw new Error('æ–‡å­—åŒ…å«ç„¡æ³•è™•ç†çš„å­—ç¬¦');\n  }\n  \n  // å›å‚³æ•´ç†å¾Œçš„çµæœ\n  return [\n    {\n      json: {\n        replyToken: replyToken,\n        text: finalText\n      }\n    }\n  ];\n  \n} catch (error) {\n  // éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„\n  console.error('è™•ç†æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤:', error.message);\n  console.error('éŒ¯èª¤è©³æƒ…:', error);\n  \n  // å˜—è©¦å–å¾— replyToken ç”¨æ–¼éŒ¯èª¤å›æ‡‰\n  let fallbackReplyToken = null;\n  try {\n    const replyTokenItem = items.find(item => \n      (item.json?.body?.events?.[0]?.replyToken) || \n      (item.body?.events?.[0]?.replyToken)\n    );\n    fallbackReplyToken = replyTokenItem?.json?.body?.events?.[0]?.replyToken || \n                        replyTokenItem?.body?.events?.[0]?.replyToken;\n  } catch (e) {\n    console.error('ç„¡æ³•å–å¾— fallback replyToken:', e.message);\n  }\n  \n  // å¦‚æœæœ‰ replyTokenï¼Œå›å‚³éŒ¯èª¤è¨Šæ¯\n  if (fallbackReplyToken) {\n    return [\n      {\n        json: {\n          replyToken: fallbackReplyToken,\n          text: \"æŠ±æ­‰ï¼Œè™•ç†æ‚¨çš„è¨Šæ¯æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚\"\n        }\n      }\n    ];\n  }\n  \n  // å¦‚æœé€£ replyToken éƒ½æ²’æœ‰ï¼Œæ‹‹å‡ºéŒ¯èª¤è®“ n8n è™•ç†\n  throw new Error('ç„¡æ³•è™•ç†è«‹æ±‚ï¼š' + error.message);\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2512,
        -16
      ],
      "id": "319724b9-e2a9-4fcd-b13e-6df39820e314",
      "name": "Code"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        2320,
        32
      ],
      "id": "67387018-1bc1-4995-a8f6-af17f85ba9be",
      "name": "Merge"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@ITR",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "c528785b-7a2a-48d7-893b-75b93f661466"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3593438c-d64d-421e-a2c3-e193690cc884",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@FACT",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4e2c522a-a476-42d8-8a32-64ea60b5a82e",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@NEWS",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "610549b7-2ef1-4c27-ac34-f7201350a4c3",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@DR",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "25037b5a-9c6c-47c7-8982-6fa877baaf64",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@STOCK",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2a7c00d2-1f25-44da-a7ba-5710145dd71d",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@CB",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b1a4ab87-bb58-4984-9c29-586f6b412763",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@WEB",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5517c22e-36d7-4b02-af4f-23cafe5a556d",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@SUBS",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ea96a8a5-0aa0-4ea4-a1bf-0415f375e2ee",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@EAT",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5af5b924-b52e-47eb-9b7d-547d3b0da6b0",
                    "leftValue": "={{ $json.body.events[0].message.type }}",
                    "rightValue": "image",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5a89aaf8-ef73-445a-87d8-2622ecaa65ee",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@help",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b9ae6f33-b95d-42bf-a029-f14c64e807af",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@GPT20 ",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "01bf1084-fd82-4d9e-83a7-b3f3bec66bae",
                    "leftValue": "={{$json[\"body\"][\"events\"][0][\"message\"][\"text\"]}}",
                    "rightValue": "@GPT120 ",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -208,
        16
      ],
      "id": "a87e12ff-cd4e-4c4f-9b65-aad332d309b7",
      "name": "Switch"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# è«‹ä½ æ ¹æ“šä»¥ä¸‹æ ¼å¼ï¼Œ**å…¨é¢åˆ†æé€™æ®µå…§å®¹çš„çœŸå¯¦æ€§ã€æƒ…ç·’å‚¾å‘èˆ‡å®¢è§€ç¨‹åº¦**ã€‚è«‹ç‰¹åˆ¥æ³¨æ„æ˜¯å¦å­˜åœ¨æ½›åœ¨åè¦‹ã€èª¤å°ã€èª‡å¤§æˆ–è™›å‡è¨Šæ¯ã€‚å…§å®¹å¦‚ä¸‹ï¼š\n**ã€Œ{{ $json.body.events[0].message.text }}ã€**\n\n  - å¦‚å…§å®¹åŒ…å«ç¶²å€ï¼Œå˜—è©¦ä½¿ç”¨ \"Crawl Json\"æˆ–\"Jina AI\"å·¥å…·è®€å–å®Œæ•´å…§å®¹ï¼Œè‹¥æ²’æœ‰æ­£ç¢ºçˆ¬å–å…§å®¹è«‹å›è¦†éŒ¯èª¤è¨Šæ¯ã€‚å…§å®¹ä¾ç…§è¦æ±‚è¼¸å‡ºã€‚\n\n  - å¦‚å…§å®¹åŒ…å«youtubeç¶²å€ï¼Œä½¿ç”¨\"Gemini_video_understand\"å·¥å…·è®€å–å½±ç‰‡ï¼Œå…§å®¹ä¾ç…§è¦æ±‚è¼¸å‡ºã€‚è‹¥æ²’æœ‰æ­£ç¢ºè®€å–å…§å®¹è«‹å›è¦†éŒ¯èª¤è¨Šæ¯ã€‚\n\n## åŸºæœ¬è¦æ±‚\n- **èªè¨€**ï¼šç¹é«”ä¸­æ–‡\n- **å¹³å°**ï¼šLINE é€šè¨Šè»Ÿé«”é©é…\n- **å­—æ•¸**ï¼šæ§åˆ¶åœ¨ 300 å­—ä»¥å…§\n- **æ ¼å¼**ï¼šç´”æ–‡å­—ï¼Œé¿å… Markdown å’Œ HTML èªæ³•\n- âœ… åƒ…è¼¸å‡ºï¼šæœ€çµ‚æ•´ç†å®Œæˆçš„å…§å®¹ç¸½çµ\n\n## ğŸ” è«‹æ ¹æ“šä»¥ä¸‹æ ¼å¼è¼¸å‡ºåˆ†æçµæœï¼š\n\nğŸ“Š **å®¢è§€åˆ†æ**  \nåˆ†æå…§å®¹æ˜¯å¦ä»¥äº‹å¯¦ç‚ºåŸºç¤ï¼Œæ˜¯å¦å¼•ç”¨å¯ä¿¡ä¾†æºï¼Œèªå¥æ˜¯å¦ä¸­ç«‹ã€‚æŒ‡å‡ºå…¶ä¸­é™³è¿°çš„äº‹å¯¦èˆ‡æ„è¦‹åˆ†åˆ¥ç‚ºä½•ã€‚\n\nğŸ­ **æƒ…ç·’å‚¾å‘åˆ†æ**  \nåˆ†æèªæ°£æ˜¯å¦å…·ç…½å‹•æ€§ã€æ†¤æ€’ã€æ‚²å‚·ã€æ¨‚è§€ç­‰æƒ…ç·’å‚¾å‘ã€‚åˆ¤æ–·é€™äº›æƒ…ç·’æ˜¯å¦æœƒå½±éŸ¿é–±è½äººåˆ¤æ–·ã€‚\n\nğŸš¨ **æ½›åœ¨çš„è™›å‡ä¿¡æ¯æˆ–åè¦‹ï¼Œä»¥åŠå¯ç–‘é»**  \næŒ‡å‡ºå…§å®¹ä¸­æ˜¯å¦å‡ºç¾ä¸å¯¦ã€èª¤å°æ€§æ•˜è¿°ã€å–®æ–¹é¢è§€é»ã€åˆ»æ¿å°è±¡ç­‰ã€‚è«‹åˆ—èˆ‰å…·é«”èªå¥æˆ–æ®µè½ï¼Œä¸¦èªªæ˜ç‚ºä½•å€¼å¾—æ‡·ç–‘ã€‚\n\nğŸ” **å»ºè­°æŸ¥è­‰çš„äº‹å¯¦**  \nåˆ—å‡ºéœ€è¦é€²ä¸€æ­¥æŸ¥è­‰çš„å…·é«”è³‡è¨Šï¼ˆå¦‚äººåã€æ•¸å­—ã€äº‹ä»¶ã€å¼•ç”¨ã€åœ–ç‰‡ã€ä¾†æºã€å½±ç‰‡ç­‰ï¼‰ï¼Œä»¥é‡æ¸…å…¶çœŸå¯¦æ€§ã€‚\n\nğŸ“ **ç¸½çµ**  \nè«‹ç°¡è¦æ¦‚æ‹¬ä»¥ä¸Šæ¬„ä½çš„ä¸»æ—¨èˆ‡è¦å‚³é”çš„æ ¸å¿ƒè¨Šæ¯ã€‚\n\nâœ… **è£œå……å»ºè­°**\n- è‹¥åŸå§‹å…§å®¹ç‚ºåœ–ç‰‡ã€å½±ç‰‡ã€ç¤¾ç¾¤è²¼æ–‡ï¼Œè«‹èªªæ˜æ˜¯å¦å­˜åœ¨ç¯¡æ”¹æˆ–æ–·ç« å–ç¾©çš„å¯èƒ½æ€§ã€‚\n- è‹¥ä½ èƒ½å¼•ç”¨å…·å…¬ä¿¡åŠ›ä¾†æºï¼ˆå¦‚å®˜æ–¹ã€å­¸è¡“ã€ä¸»æµåª’é«”ï¼‰ä¾†ä½è­‰æˆ–åé§ï¼Œä¹Ÿè«‹åˆ—å‡ºã€‚",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1920,
        -480
      ],
      "id": "7ebc4d53-85bb-4327-82a1-fe8144f0c2ab",
      "name": "FACT Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1904,
        -288
      ],
      "id": "88c99857-86ff-46af-89e8-7a07268de61a",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "gP2wixnvp3ugX2H0",
          "name": "Google Gemini(PaLM) Api account 2"
        }
      }
    },
    {
      "parameters": {
        "description": "It lets you use crawl and scrape websites in your n8n workflows.\n",
        "workflowId": {
          "__rl": true,
          "value": "fuPMDOgf9FmrW7zB",
          "mode": "list",
          "cachedResultName": "LINE CHATBOT_Crawl_json"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "URL": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}"
          },
          "matchingColumns": [
            "URL"
          ],
          "schema": [
            {
              "id": "URL",
              "displayName": "URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1856,
        -688
      ],
      "id": "0a42f462-131e-433b-a90e-9b9fc3feabb4",
      "name": "Crawl_Json"
    },
    {
      "parameters": {
        "toolDescription": "Call this tool to get a youtube  video summary.\n",
        "url": "http://gemini-api:8000/summarize",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "url",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1968,
        -688
      ],
      "id": "b802de13-8738-4752-9677-7a10dfbee5c0",
      "name": "Gemini_Video_Understand"
    },
    {
      "parameters": {
        "toolDescription": "use firecrawl and scrape websites in your n8n workflows.",
        "method": "POST",
        "url": "http://api:3002/v1/scrape",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "url",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            },
            {
              "name": "formats",
              "value": "={{ [\"markdown\"] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        2096,
        -688
      ],
      "id": "90497786-0e01-4bf9-9162-6933498c7d38",
      "name": "Firecrawl"
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1728,
        -688
      ],
      "id": "b5ea9355-7989-4885-b01c-d4f341567bb4",
      "name": "gemini-2.5-flash",
      "credentials": {
        "googlePalmApi": {
          "id": "m3rIFo4KWXjpkCMd",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1856,
        624
      ],
      "id": "a8d4b483-2e43-4cde-8d8d-09fff7966f28",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "IPHSLQRyWQXZYdKx",
          "name": "Google Gemini(PaLM) Api account 5"
        }
      }
    },
    {
      "parameters": {
        "description": "ä½¿ç”¨é€™å€‹å·¥å…·å–å¾—æ–°èæ–‡ç« ï¼Œè³‡æ–™åº«å…§åŒ…å«çš„æ¬„ä½æœ‰æ–°èçš„æ¨™é¡Œã€ç™¼å¸ƒæ™‚é–“ã€å…§æ–‡ã€ç¶²å€ï¼Œè¼¸å…¥ä»¥é€™äº›æ¬„ä½ç‚ºæ¢ä»¶çš„è‡ªç„¶èªè¨€æŒ‡ä»¤ã€‚é€™å€‹å·¥å…·æœƒå°‡è‡ªç„¶èªè¨€çš„éœ€æ±‚è½‰æ›ç‚º SQL æŸ¥è©¢ï¼Œä¸¦å›å‚³æ–°èæ–‡ç« çš„æŸ¥è©¢çµæœã€‚\n\nè¼¸å…¥ç¯„ä¾‹ï¼š\n1. åˆ—å‡ºä»Šæ—¥æ‰€æœ‰çš„æ–°èæ¨™é¡Œ\n2. åˆ—å‡ºæœ¬é€±çš„æ–°èæ¨™é¡Œèˆ‡å…§æ–‡èˆ‡ç¶²å€\n3. åˆ—å‡ºé€™ä¸‰å¤©çš„æ–°èæ¨™é¡Œèˆ‡å…§æ–‡èˆ‡ç¶²å€\n\né‡è¦ï¼š\n- é€™å€‹å·¥å…·ä¸èƒ½ç”¢ç”Ÿæ‘˜è¦ï¼Œåªèƒ½å›å‚³æ–°èæ–‡ç« é™£åˆ—\n- ä¸è¦ä»¥ã€Œæ‘˜è¦â‹¯â‹¯ã€ä½œç‚º natural_language_query",
        "workflowId": {
          "__rl": true,
          "value": "HAIIAhz50naJPpU4",
          "mode": "list",
          "cachedResultName": "LINE_CHATBOT_database_query_tool"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "natural_language_query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('natural_language_query', ``, 'string') }}"
          },
          "matchingColumns": [
            "natural_language_query"
          ],
          "schema": [
            {
              "id": "natural_language_query",
              "displayName": "natural_language_query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1968,
        624
      ],
      "id": "10f34095-943c-45a1-a577-7e37252adfed",
      "name": "News_db_query"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        1504,
        512
      ],
      "id": "753157b1-e3f4-4c04-973e-afdb663cfb68",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "toolDescription": "The agent is designed to perform comprehensive research on a user's query by dynamically generating search terms, querying the web using Google Search, reflecting on the results to identify knowledge gaps, and iteratively refining its search until it can provide a well-supported answer with citations. \neffort=[low, medium, high],default=medium",
        "method": "POST",
        "url": "http://gemini-dr-api:8080/ask",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "question",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            },
            {
              "name": "effort",
              "value": "=medium"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1968,
        224
      ],
      "id": "ce8622a3-ec81-487b-a35a-4c20f05450ab",
      "name": "Deep Research"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1856,
        224
      ],
      "id": "331eb170-6f55-427c-beda-583340b2deaa",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "IPHSLQRyWQXZYdKx",
          "name": "Google Gemini(PaLM) Api account 5"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½¿ç”¨è€…è¼¸å…¥**ã€Œ{{ $('Switch').item.json.body.events[0].message.text }}ã€**\n- ä½¿ç”¨å·¥å…·\"Deep Reasearch\"å°ä½¿ç”¨è€…è¼¸å…¥é€²è¡Œæ·±åº¦ç ”ç©¶\n\n## è¼¸å‡ºæ ¼å¼è¦æ±‚\n* æ•´ç†æˆä¸€ä»½ é©åˆåœ¨ LINE å‚³é€çš„ã€Œç ”ç©¶å ±å‘Šæ ¼å¼ã€ï¼š\n* æ¢åˆ—æ¸…æ¥šã€åˆ†æ®µæœ‰å°æ¨™é¡Œ\n* é©åº¦ä½¿ç”¨ emoji ä½œç‚ºåˆ†éš”ç¬¦è™Ÿï¼ˆé¿å…å¤ªå¤šè£é£¾ï¼‰\n* ä¿ç•™è³‡è¨Šå®Œæ•´æ€§èˆ‡ã€Œç ”ç©¶æ„Ÿã€\n* å¼•ç”¨ä¾†æºè¦ä¿ç•™ï¼Œä½†ä»¥ç°¡æ½”å½¢å¼å‘ˆç¾ï¼ˆå¦‚ [youlai]ã€[ettoday]ã€[xzh6]ï¼‰ï¼Œåœ¨æ–‡ç« æœ€å¾Œå‘ˆç¾ç¶²å€\nurlå¿…é ˆæ˜¯æœ‰æ•ˆé€£çµï¼\n  ä¾‹å¦‚ï¼š[yahoo]https://tw.yahoo.com/\n  [google]https://www.google.com/?hl=zh_TW\n* å¯ä»¥é©åº¦å»¶é•·å…§æ–‡ï¼Œè®“å…§å®¹çœ‹èµ·ä¾†æ›´æœ‰ã€Œç ”ç©¶æ·±åº¦ã€",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1824,
        0
      ],
      "id": "275e0c92-2693-44de-bd8b-5e23739ad684",
      "name": "DR Agent"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=æ ¹æ“šç•¶å‰æ™‚é–“ {{ $json.currentDate }} æ±ºå®šå¾ŒçºŒåƒæ•¸è¨­å®š\nä½¿ç”¨è€…è¼¸å…¥**ã€Œ{{ $('Switch').item.json.body.events[0].message.text }}ã€**",
        "options": {
          "systemMessage": "=## ğŸ“° è§’è‰²æŒ‡ä»¤ï¼šæ–°èæ•´ç†å°ˆå®¶\n\nä½ æ˜¯ä¸€ä½æ“…é•·è³‡è¨Šçµ±æ•´çš„æ–°èæ•´ç†å°ˆå®¶ï¼Œè² è²¬æ ¹æ“šä½¿ç”¨è€…éœ€æ±‚ï¼Œå›å‚³æ¸…æ™°ã€æœ‰çµ„ç¹”çš„æ–°èè³‡è¨Šã€‚  \nä½ å¯ä»¥ä½¿ç”¨å…§å»ºçš„å·¥å…·ï¼šæ–°èæŸ¥è©¢å·¥å…·**News_db_query**ã€‚\n\n### ğŸ“Œ æ“ä½œè¦å‰‡\n\n#### 1. ç•¶ä½¿ç”¨è€…è¦æ±‚ã€Œæ‘˜è¦æ–°èã€æ™‚ï¼š\n- ä½¿ç”¨**News_db_query**ä¸»å‹•æŸ¥è©¢ç•¶å‰ç†±é–€æˆ–ç›¸é—œæ–°èï¼Œéœ€è¦è¼¸å‡ºæ–°èå…§æ–‡ã€ä¾†æºç¶²å€ã€‚\n- å°‡æŸ¥è©¢çµæœé€²è¡Œ**æ•´ç†èˆ‡æ‘˜è¦**ï¼Œå¼·èª¿é‡é»èˆ‡èƒŒæ™¯è„ˆçµ¡ã€‚\n- å¦‚æœ‰å¤šç¯‡å ±å°æ¶‰åŠç›¸åŒä¸»é¡Œï¼Œè«‹ï¼š\n  - æ•´åˆå…§å®¹ï¼Œ**é¿å…é‡è¤‡**ã€‚\n  - æä¾›**å®Œæ•´ã€é€£è²«çš„ç¶œåˆæ‘˜è¦**ï¼Œå­—å¯ä»¥ç¨å¤šï¼Œ100å­—å…§ã€‚\n  - æ¯ç¯‡å ±å°å¾Œï¼Œé™„ä¸Šä¾†æºç¶²å€\n\n#### 2. ç•¶ä½¿ç”¨è€…è¦æ±‚ã€Œåˆ—å‡ºæ–°èæ¨™é¡Œã€æ™‚ï¼š\n- åŒæ¨£ä½¿ç”¨**News_db_query**å–å¾—æ–°èæ–‡ç« ã€‚\n- èƒå–æ‰€æœ‰æ¨™é¡Œï¼Œä¸¦æ ¹æ“š**ä¸»é¡Œç›¸ä¼¼æ€§é€²è¡Œåˆ†çµ„**ã€‚\n- ç‚ºæ¯ä¸€çµ„æä¾›**ç°¡çŸ­çš„ä¸»é¡Œèªªæ˜**ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…å¿«é€ŸæŒæ¡ç„¦é»ã€‚\n\n#### 3. æŸ¥è©¢æ–°èæ™‚çš„ä¸»å‹•æ€§ï¼š\n- **ä¸è¦æ±‚ä½¿ç”¨è€…è¼¸å…¥æ–°èä¸»é¡Œ**ã€‚\n- ç›´æ¥æ ¹æ“šæ™‚äº‹ã€ç†±é–€è¶¨å‹¢ã€é—œéµå­—ç­‰ï¼Œè‡ªè¡Œåˆ¤æ–·æŸ¥è©¢ç›®æ¨™ã€‚\n- ä¿æŒä¸»å‹•æ€§èˆ‡æ™ºæ…§åˆ¤æ–·ï¼Œç¢ºä¿è³‡è¨Šçš„å³æ™‚æ€§èˆ‡å®Œæ•´æ€§ã€‚\n\n### ğŸ§° å¯ç”¨å·¥å…·\n\n- `News_db_query`ï¼šå¯ç”¨ä¾†æŸ¥æ‰¾æœ€æ–°ã€ç›¸é—œæ–°èå…§å®¹ã€‚\n\n### æ ¼å¼å„ªåŒ–æŒ‡å¼•\n- ä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿå¢å¼·è¦–è¦ºæ•ˆæœå’Œå¯è®€æ€§\n- é©ç•¶é‹ç”¨åˆ†éš”ç·šå’Œç©ºè¡Œæå‡çµæ§‹æ¸…æ™°åº¦\n- é‡å°æ‰‹æ©Ÿé–±è®€é«”é©—å„ªåŒ–æ’ç‰ˆ\n- ç¢ºä¿å…§å®¹å®Œæ•´ä¸”é‚è¼¯æ¸…æ¥š\n\n### è¼¸å‡ºé™åˆ¶\nâŒ ç¦æ­¢ä½¿ç”¨ï¼šMarkdown èªæ³•ï¼ˆ#ã€**ã€[]()ç­‰ï¼‰\nâŒ ç¦æ­¢ä½¿ç”¨ï¼šHTML æ¨™ç±¤\nâŒ ç¦æ­¢è¼¸å‡ºï¼šè™•ç†éç¨‹èªªæ˜æˆ–é¡å¤–è¨»è§£\nâœ… åƒ…è¼¸å‡ºï¼šæœ€çµ‚æ•´ç†å®Œæˆçš„å…§å®¹ç¸½çµ\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1824,
        400
      ],
      "id": "1c3380c0-3200-4f51-93f1-72951b6776a4",
      "name": "NEWS Agent"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# ä¸»è¦ä»»å‹™\nåˆ†æç”¨æˆ¶è¼¸å…¥å…§å®¹ï¼šã€Œ{{ $json.body.events[0].message.text }}ã€\n\n## è™•ç†é‚è¼¯\n\n### å…§å®¹è™•ç†\n**è™•ç†æ–¹å¼**ï¼š\n  - ç¢ºä¿å‚³å…¥çš„urlå’ŒåŸæ–‡ä¸€æ¨£ã€‚\n  - å¦‚å…§å®¹åŒ…å«ç¶²å€ï¼Œä¾åºä½¿ç”¨ \"Firecrawl\"ã€\"Crawl_json\"å·¥å…·è®€å–å®Œæ•´å…§å®¹ï¼Œè‹¥æ²’æœ‰æ­£ç¢ºçˆ¬å–å…§å®¹å˜—è©¦ä¸‹ä¸€å€‹å·¥å…·,éƒ½æ²’æœ‰æ­£ç¢ºçˆ¬å–çš„è©±ï¼Œè«‹å›è¦†éŒ¯èª¤è¨Šæ¯ã€‚å…§å®¹ä¾ç…§è¦æ±‚è¼¸å‡ºã€‚\n- å¦‚å…§å®¹åŒ…å«youtubeç¶²å€ï¼Œä½¿ç”¨\"Gemini_video_understand\"å·¥å…·è®€å–å½±ç‰‡ï¼Œå…§å®¹ä¾ç…§è¦æ±‚è¼¸å‡ºã€‚è‹¥æ²’æœ‰æ­£ç¢ºè®€å–å…§å®¹è«‹å›è¦†éŒ¯èª¤è¨Šæ¯ã€‚\n\n### è¼¸å‡ºæ¨£æ¿é¸æ“‡\n- ä¸€èˆ¬æƒ…æ³ä¾ç…§ã€Œæ¨™æº–è¼¸å‡ºæ¨¡æ¿ã€æ ¼å¼åŒ–å›è¦†,\n- è‹¥ä½¿ç”¨è€…è¦æ±‚è©³ç´°å ±å‘Š,å‰‡ä¾ç…§ã€Œè©³ç´°è¼¸å‡ºæ¨¡æ¿ã€è¼¸å‡º\n- å…§å®¹èˆ‡æŠ€è¡“å…§å®¹ä¸ç›¸é—œï¼Œä¾ç…§ã€ŒéæŠ€è¡“å…§å®¹è™•ç†ã€è¼¸å‡º\n\n## æŠ€è¡“å…§å®¹è¼¸å‡ºè¦ç¯„\n\n### åŸºæœ¬è¦æ±‚\n- **èªè¨€**ï¼šç¹é«”ä¸­æ–‡\n- **å¹³å°**ï¼šLINE é€šè¨Šè»Ÿé«”é©é…\n- **å­—æ•¸**ï¼šæ§åˆ¶åœ¨ 500 å­—ä»¥å…§\n- **æ ¼å¼**ï¼šç´”æ–‡å­—ï¼Œé¿å… Markdown å’Œ HTML èªæ³•\n\n### æ¨™æº–è¼¸å‡ºæ¨¡æ¿\n\n#### æ¨™é¡Œå€å¡Š\nğŸ“‹ {æœƒè­°ä¸»é¡Œæˆ–å…§å®¹æ¨™é¡Œ}\n\n#### å…§å®¹çµæ§‹ï¼ˆä¾åºæ’åˆ—ï¼‰\n\n**ğŸ¯ æ ¸å¿ƒè§€é»**\n- æç…‰ä¸»è¦è«–é»å’Œé—œéµè­°é¡Œ\n- çªå‡ºæœ€é‡è¦çš„æ ¸å¿ƒæ¦‚å¿µ\n\n### è©³ç´°è¼¸å‡ºæ¨¡æ¿\n\n#### æ¨™é¡Œå€å¡Š\n```\nğŸ“‹ {æœƒè­°ä¸»é¡Œæˆ–å…§å®¹æ¨™é¡Œ}\n\n```\n#### å…§å®¹çµæ§‹ï¼ˆä¾åºæ’åˆ—ï¼‰\n\n**ğŸ¯ æ ¸å¿ƒè§€é»**\n- æç…‰ä¸»è¦è«–é»å’Œé—œéµè­°é¡Œ\n- çªå‡ºæœ€é‡è¦çš„æ ¸å¿ƒæ¦‚å¿µ\n\n**ğŸ“‹ è©³ç´°å…§å®¹**  \n- æ•´ç†é‡è¦è¨è«–é»å’Œé—œéµè³‡è¨Š\n- ä¿æŒé‚è¼¯é †åºå’Œå®Œæ•´è„ˆçµ¡\n\n**âœ… é‡è¦çµè«–**\n- æ­¸ç´é”æˆçš„å…±è­˜å’Œæ±ºè­°\n- æ˜ç¢ºåˆ—å‡ºå¾ŒçºŒè¡Œå‹•é …ç›®\n\n### æ ¼å¼å„ªåŒ–æŒ‡å¼•\n- ä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿå¢å¼·è¦–è¦ºæ•ˆæœå’Œå¯è®€æ€§\n- é©ç•¶é‹ç”¨åˆ†éš”ç·šå’Œç©ºè¡Œæå‡çµæ§‹æ¸…æ™°åº¦\n- é‡å°æ‰‹æ©Ÿé–±è®€é«”é©—å„ªåŒ–æ’ç‰ˆ\n- ç¢ºä¿å…§å®¹å®Œæ•´ä¸”é‚è¼¯æ¸…æ¥š\n\n### è¼¸å‡ºé™åˆ¶\nâŒ ç¦æ­¢ä½¿ç”¨ï¼šMarkdown èªæ³•ï¼ˆ#ã€**ã€[]()ç­‰ï¼‰\nâŒ ç¦æ­¢ä½¿ç”¨ï¼šHTML æ¨™ç±¤\nâŒ ç¦æ­¢è¼¸å‡ºï¼šè™•ç†éç¨‹èªªæ˜æˆ–é¡å¤–è¨»è§£\nâœ… åƒ…è¼¸å‡ºï¼šæœ€çµ‚æ•´ç†å®Œæˆçš„å…§å®¹ç¸½çµ\n\n## åŸ·è¡Œæé†’\n- åŸºæ–¼æä¾›çš„åŸå§‹å…§å®¹é€²è¡Œåˆ†æç¸½çµ\n- ç¢ºä¿å›è¦†å…§å®¹æº–ç¢ºä¸”å…·æœ‰å¯¦ç”¨åƒ¹å€¼\n- ä¿æŒå°ˆæ¥­æ€§çš„åŒæ™‚å…¼é¡§æ˜“è®€æ€§",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1808,
        -1008
      ],
      "id": "2feca3e8-e0f5-4ea4-8fd7-b97b630f6efd",
      "name": "ITR Agent"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.events[0].message.text }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=ä½ æ˜¯ä¸€å€‹è‚¡åƒ¹æŸ¥è©¢å°å¹«æ‰‹ã€‚\nä½¿ç”¨è€…æœƒè¼¸å…¥æƒ³æŸ¥è©¢çš„è‚¡ç¥¨ä»£ç¢¼ï¼ˆä¾‹å¦‚ï¼š0050ï¼‰ï¼Œæœ‰æ™‚ä¹ŸæœƒåŒ…å«æŸ¥è©¢æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š2025-06-24ï¼‰ã€‚\nè«‹ä¾æ“šè¼¸å…¥åˆ¤æ–·ä»¥ä¸‹è³‡è¨Šï¼š\nstock_idï¼šè‚¡ç¥¨ä»£ç¢¼ï¼ˆå¿…å¡«ï¼‰\ndateï¼šæŸ¥è©¢æ—¥æœŸï¼ˆé¸å¡«ï¼Œè‹¥æœªè¼¸å…¥ï¼Œé è¨­ç‚ºä»Šå¤©ï¼‰\nnow_or_historyï¼šåˆ¤æ–·ä½¿ç”¨è€…æƒ³æŸ¥è©¢çš„æ˜¯å³æ™‚è³‡æ–™é‚„æ˜¯æ­·å²è³‡æ–™ï¼Œè‹¥æœªè¼¸å…¥æ—¥æœŸæˆ–è¼¸å…¥çš„æ—¥æœŸæ˜¯ä»Šå¤©ï¼Œè«‹è¨­ç‚º \"now\"ï¼Œè‹¥è¼¸å…¥çš„æ—¥æœŸä¸æ˜¯ä»Šå¤©ï¼Œè«‹è¨­ç‚º \"history\"\nè«‹å°‡ä¸Šè¿°è³‡è¨Šæ•´ç†æˆ JSON ä¸¦å‚³éè‡³ä¸‹å€‹ HTTP Request ç¯€é»ã€‚"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        896,
        832
      ],
      "id": "7db263b5-7187-45bf-9538-b4e6aafbcdb5",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "import json\ndef execute(input):\n  try:\n    # å¾ js ç‰©ä»¶è½‰ python\n    py_input = input.to_py()\n    # å°‡ dict è½‰æˆ json\n    raw_data = json.loads(py_input['json']['data'])\n    # å–å¾— msgArray ä¸­çš„ç¬¬ä¸€ç­†è³‡æ–™\n    msg = raw_data[\"msgArray\"][0]\n    \n    # æ“·å–æ‰€éœ€æ¬„ä½\n    stock_code = msg.get(\"c\", \"N/A\")\n    stock_name = msg.get(\"n\", \"N/A\")\n    current_price = msg.get(\"z\", \"N/A\")\n    open_price = msg.get(\"o\", \"N/A\")\n    high_price = msg.get(\"h\", \"N/A\")\n    low_price = msg.get(\"l\", \"N/A\")\n    volumn = msg.get(\"v\", \"N/A\")\n    last_time = msg.get(\"t\", \"N/A\")\n    \n    return [{\n        \"json\": {\n            \"stock_code\": stock_code,\n            \"stock_name\": stock_name,\n            \"current_price\": current_price,\n            \"open_price\":open_price,\n            \"high_price\":high_price,\n            \"low_price\":low_price,\n            \"volumn\":volumn,\n            \"last_time\":last_time\n        }\n    }]\n    \n  except Exception as e:\n    return [{\n        \"json\": {\n            \"error\": f\"è§£æå¤±æ•—: {str(e)}\"\n        }\n    }]\nprint(_input.first())\nr = execute(_input.first())\nreturn r"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1488,
        832
      ],
      "id": "559a06f8-ad9c-441c-ad2d-6399448e0307",
      "name": "Code1"
    },
    {
      "parameters": {
        "url": "=https://mis.twse.com.tw/stock/api/getStockInfo.jsp?ex_ch=tse_{{$json.output.stock_id}}.tw",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1280,
        832
      ],
      "id": "c16a32e5-f39d-46a8-ad8a-a3cd4d3a1890",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{$json}}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=ä½ æ˜¯ä¸€ä½é‡‘èè³‡è¨ŠåŠ©ç†ï¼Œå°ˆé–€ç”¨ç°¡å–®æ˜ç­çš„æ–¹å¼è§£é‡‹è‚¡ç¥¨çš„å³æ™‚å ±åƒ¹è³‡æ–™ã€‚\nè«‹æ ¹æ“šä»¥ä¸‹æä¾›çš„æ¬„ä½è³‡è¨Šï¼Œåˆ†æé€™æª”è‚¡ç¥¨ç›®å‰çš„äº¤æ˜“æƒ…æ³ï¼Œä¸¦èªªæ˜ï¼š\n- è‚¡ç¥¨ä»£è™Ÿï¼ˆstock_codeï¼‰\n- è‚¡ç¥¨åç¨±ï¼ˆstock_nameï¼‰ \n- ç•¶ç›¤æˆäº¤åƒ¹ï¼ˆcurrent_priceï¼‰ï¼šå³ç›®å‰æœ€æ–°æˆäº¤åƒ¹ \n- ä»Šæ—¥é–‹ç›¤åƒ¹ï¼ˆopen_priceï¼‰ï¼šç•¶æ—¥å¸‚å ´é–‹ç›¤çš„ç¬¬ä¸€ç­†æˆäº¤åƒ¹ \n- ä»Šæ—¥æœ€é«˜åƒ¹ï¼ˆhigh_priceï¼‰ï¼šä»Šæ—¥æˆªè‡³ç›®å‰çš„æœ€é«˜æˆäº¤åƒ¹ \n- ä»Šæ—¥æœ€ä½åƒ¹ï¼ˆlow_priceï¼‰ï¼šä»Šæ—¥æˆªè‡³ç›®å‰çš„æœ€ä½æˆäº¤åƒ¹\n- ç•¶ç›¤æˆäº¤é‡ï¼ˆvolumnï¼‰ï¼šä»Šæ—¥æˆªè‡³ç›®å‰çš„æˆäº¤é‡\n- æœ€è¿‘æˆäº¤æ™‚åˆ»ï¼ˆlast_timeï¼‰ï¼šæœ€è¿‘æˆäº¤æ™‚åˆ»ï¼ˆæ ¼å¼ç‚º HH:MM:SSï¼‰\nè«‹ä»¥æ¢åˆ—å¼æä¾›ä»¥ä¸Šè³‡è¨Šï¼Œä¸¦æ ¹æ“šä¸‹åˆ—é‚è¼¯æ’°å¯«ã€Œä»Šæ—¥è‚¡åƒ¹æ³¢å‹•æè¿°ã€ï¼š\n- å°è‚¡äº¤æ˜“æ™‚é–“ç‚º 09:00â€“13:30ï¼Œè‹¥ {{$json.last_time}} ç‚º 13:30:30ï¼Œä»£è¡¨ä»Šæ—¥å·²æ”¶ç›¤ï¼Œå¯æ ¹æ“šç•¶æ—¥é«˜ä½é»èˆ‡é–‹æ”¶åƒ¹ç¸½çµå…¨å¤©èµ°å‹¢ã€‚\n- è‹¥ç›®å‰ä»ç‚ºç›¤ä¸­ï¼ˆé 13:30ï¼‰æˆ–æˆäº¤åƒ¹ç„¡æ•ˆç‚º \"-\"ï¼Œå¯ç”¨é–‹ç›¤åƒ¹ã€æœ€é«˜åƒ¹èˆ‡æœ€ä½åƒ¹çš„ç›¸å°é—œä¿‚ï¼Œç°¡è¦æè¿°ä»Šæ—¥ç›¤ä¸­æ³¢å‹•æƒ…æ³ã€‚\n- å¯ä»¥æŒ‡å‡ºç›®å‰åƒ¹æ ¼èˆ‡é–‹ç›¤åƒ¹ç›¸æ¯”çš„æ¼²è·Œç‹€æ³ï¼ˆä¸Šæ¼²ã€ä¸‹è·Œæˆ–æŒå¹³ï¼‰ã€‚\nè«‹ä½¿ç”¨ä¸­ç«‹ã€å°ˆæ¥­ä¸”èªæ„ç°¡æ½”çš„èªæ°£å›ç­”ã€‚\n\n### æ ¼å¼å„ªåŒ–æŒ‡å¼•\n- é©ç•¶é‹ç”¨åˆ†éš”ç·šå’Œç©ºè¡Œæå‡çµæ§‹æ¸…æ™°åº¦\n- å¦‚æœæ•¸å­—æœ‰å°æ•¸é»ï¼Œè«‹çµ±ä¸€å–åˆ°å°æ•¸é»å¾Œç¬¬äºŒä½\n- é‡å°æ‰‹æ©Ÿé–±è®€é«”é©—å„ªåŒ–æ’ç‰ˆ\n- ç¢ºä¿å…§å®¹å®Œæ•´ä¸”é‚è¼¯æ¸…æ¥š\n\n### è¼¸å‡ºé™åˆ¶\nâŒ ç¦æ­¢ä½¿ç”¨ï¼šMarkdown èªæ³•ï¼ˆ#ã€**ã€[]()ç­‰ï¼‰\nâŒ ç¦æ­¢ä½¿ç”¨ï¼šHTML æ¨™ç±¤\nâŒ ç¦æ­¢è¼¸å‡ºï¼šè™•ç†éç¨‹èªªæ˜æˆ–é¡å¤–è¨»è§£\nâœ… åƒ…è¼¸å‡ºï¼šæœ€çµ‚æ•´ç†å®Œæˆçš„å…§å®¹ç¸½çµ"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        1792,
        832
      ],
      "id": "9b4b4879-27ee-4b73-9060-17c18fc47aaa",
      "name": "Basic LLM Chain1"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-001",
        "options": {
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        896,
        960
      ],
      "id": "e2a3882c-32e1-406c-a72f-c9f8db0d833c",
      "name": "Google Gemini Chat Model3",
      "credentials": {
        "googlePalmApi": {
          "id": "IPHSLQRyWQXZYdKx",
          "name": "Google Gemini(PaLM) Api account 5"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-001",
        "options": {
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1792,
        992
      ],
      "id": "a4a7dd1c-d3d5-4a2a-b6da-0595ce699fd5",
      "name": "Google Gemini Chat Model4",
      "credentials": {
        "googlePalmApi": {
          "id": "IPHSLQRyWQXZYdKx",
          "name": "Google Gemini(PaLM) Api account 5"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"stock_id\": \"0050\",\n\t\"date\": \"2025-06-15\",\n    \"now_or_history\":\"now\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1056,
        960
      ],
      "id": "de9fdc7f-be8a-4e64-a29b-7e874de567fe",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"output\": \"è‚¡ç¥¨ä»£è™Ÿï¼š2330\\nè‚¡ç¥¨åç¨±ï¼šå°ç©é›»\\nç•¶ç›¤æˆäº¤åƒ¹ï¼š1050.0000\\nä»Šæ—¥é–‹ç›¤åƒ¹ï¼š1045.0000\\nä»Šæ—¥æœ€é«˜åƒ¹ï¼š1050.0000\\nä»Šæ—¥æœ€ä½åƒ¹ï¼š1040.0000\\nç•¶ç›¤æˆäº¤é‡ï¼š27924\\næœ€è¿‘æˆäº¤æ™‚åˆ»ï¼š13:30:00\\n\\nä»Šæ—¥å°ç©é›»æ”¶ç›¤åƒ¹ç‚º 1050.0000ï¼Œè¼ƒé–‹ç›¤åƒ¹ä¸Šæ¼²ã€‚å…¨å¤©è‚¡åƒ¹åœ¨ 1040.0000 è‡³ 1050.0000 ä¹‹é–“æ³¢å‹•ã€‚\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1952,
        992
      ],
      "id": "8cf7516e-d642-4b37-bd5b-cfcae98482da",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "line-message",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -368,
        160
      ],
      "id": "3e20df60-b42d-4dfd-b13a-5434953f4f7e",
      "name": "Webhook",
      "webhookId": "PLACEHOLDER-WEBHOOK-ID"
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "itr-aimasteryhub-lab",
          "mode": "list",
          "cachedResultName": "ITR-AIMasteryHub-LAB",
          "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=itr-aimasteryhub-lab"
        },
        "sqlQuery": "SELECT *\nFROM `itr-aimasteryhub-lab.Update_Notifier.update_info`\nWHERE website = \"{{$json.website}}\"\nORDER BY create_date DESC\nLIMIT 1\n",
        "options": {}
      },
      "type": "n8n-nodes-base.googleBigQuery",
      "typeVersion": 2.1,
      "position": [
        1712,
        1216
      ],
      "id": "6c4fcf90-5c99-4fda-aafe-8494e1d5f4ec",
      "name": "Execute a SQL query",
      "alwaysOutputData": true,
      "credentials": {
        "googleBigQueryOAuth2Api": {
          "id": "7y1khtJIgFs3bnp8",
          "name": "Google BigQuery account 2"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-001",
        "options": {
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1872,
        1360
      ],
      "id": "1e22557c-0c08-4047-b848-5cc9f69966a9",
      "name": "Google Gemini Chat Model5",
      "credentials": {
        "googlePalmApi": {
          "id": "bmQtF6LTFzuCRm0S",
          "name": "Google Gemini(PaLM) Api account 4"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"output\":\"summarize content\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        2032,
        1360
      ],
      "id": "6e3791ed-3614-4a0d-8880-af365884c290",
      "name": "Structured Output Parser2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=è™•ç†æŒ‡ç¤º\nä½ æ˜¯ä¸€ä½è² è²¬ç”¢å“æ›´æ–°é€šçŸ¥çš„åŠ©ç†ï¼Œè«‹æ ¹æ“šä»¥ä¸‹è³‡è¨Šï¼Œè«‹ä¾ç…§ä»¥ä¸‹æ­¥é©Ÿè™•ç†æˆ‘æä¾›çš„ã€Œæ›´æ–°å…§å®¹ã€ï¼Œä¸¦éµå¾ªæ‰€æœ‰æ ¼å¼è¦æ±‚ï¼š\n\n1. å…§éƒ¨ç†è§£ï¼ˆä¸è¼¸å‡ºï¼‰\n- ä»”ç´°é–±è®€æä¾›çš„ã€Œcontentã€æ›´æ–°èªªæ˜ã€‚\n- ä¸éœ€è¼¸å‡ºä»»ä½•é–±è®€éç¨‹æˆ–è§£é‡‹ã€‚\n\n2. è¼¸å‡ºç‰ˆæœ¬æ›´æ–°æ‘˜è¦ï¼ˆåƒ…è¼¸å‡ºæ­¤éƒ¨åˆ†ï¼‰\nè«‹æ ¹æ“šã€Œæ›´æ–°å…§å®¹ã€ä¾†æ’°å¯«ã€Œæ›´æ–°é‡é»æ‘˜è¦ã€ï¼Œæ¢åˆ—é‡è¦çš„æ”¹å‹•ï¼Œå…·é«”çµæ§‹å¦‚ä¸‹ï¼š\n- è«‹å…ˆè¼¸å‡ºæ¨™é¡Œï¼š\n  - ç¬¬ä¸€è¡Œè¼¸å‡º æ‚¨å¥½ï¼Œä»¥ä¸‹æ˜¯ {{$json.website}} ç‰ˆæœ¬è³‡è¨Šï¼\n  - ç¬¬äºŒè¡Œè¼¸å‡º ç¶²ç«™åç¨±ï¼š{{$json.website}} \n  - ç¬¬ä¸‰è¡Œè¼¸å‡º æœ€æ–°ç‰ˆæœ¬ï¼š{{$json.version}}\n- è¼¸å‡ºæ›´æ–°å…§å®¹æ‘˜è¦ (è«‹æ‘˜è¦ä¸¦æ¢åˆ—æœ¬æ®µå…§å®¹)\n\tå®Œæ•´æ›´æ–°å…§å®¹ï¼š{{ $json.content }}\n\n\tè¼¸å‡ºç¯„ä¾‹:\n\t---\n  æ‚¨å¥½ï¼Œä»¥ä¸‹æ˜¯ Cursor ç‰ˆæœ¬è³‡è¨Šï¼š\n\n\tâ— ç¶²ç«™åç¨±ï¼šCursor  \n\tâ— æœ€æ–°ç‰ˆæœ¬ï¼š0.48.9\n\n\tæœ¬æ¬¡æ›´æ–°é‡é»åŒ…æ‹¬ï¼š\n\t- å¼•å…¥ Chat Tabsï¼Œå¯åŒæ™‚é€²è¡Œå¤šå€‹å°è©±  \n\t- å…¨æ–°ã€Œè‡ªè¨‚æ¨¡å¼ï¼ˆCustom Modesï¼‰ã€æ”¯æ´éµç›¤å¿«é€Ÿéµ  \n\t- ç´¢å¼•æ•ˆèƒ½å¤§å¹…æå‡ï¼Œå¤§å‹å°ˆæ¡ˆè™•ç†æ›´è¿…é€Ÿ  \n\t- èŠå¤©å®Œæˆæ™‚æ–°å¢éŸ³æ•ˆé€šçŸ¥ï¼ˆBetaï¼‰  \n\t- å¯æŸ¥çœ‹æ¯æ¬¡èŠå¤©çš„æ¨¡å‹ä½¿ç”¨æˆæœ¬\n\t---\n\n3. è¼¸å‡ºé™åˆ¶\n- è«‹åƒ…è¼¸å‡ºæ­¥é©Ÿ2çš„ã€Œç‰ˆæœ¬æ›´æ–°æ‘˜è¦ã€ã€‚\n- ç¦æ­¢ä½¿ç”¨ï¼šMarkdown èªæ³•ï¼ˆ#ã€**ã€[]()ç­‰ï¼‰\n- ç¦æ­¢ä½¿ç”¨ï¼šHTML æ¨™ç±¤\n- ç¦æ­¢è¼¸å‡ºï¼šè™•ç†éç¨‹èªªæ˜æˆ–é¡å¤–è¨»è§£\n- å…¨æ–‡å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚",
        "hasOutputParser": true,
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        1856,
        1216
      ],
      "id": "06e2b476-e9de-4958-9423-631f74a73220",
      "name": "Basic LLM Chain2"
    },
    {
      "parameters": {
        "content": "## å–å¾—ç¶²ç«™æ›´æ–°è³‡è¨Š",
        "height": 80,
        "width": 260,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        672,
        1184
      ],
      "typeVersion": 1,
      "id": "b96c16fc-7b72-4a28-bb00-acd607501832",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "query = items[0].json['body']['events'][0]['message']['text']\nweb = query[5:]\nreturn {\"website\": web}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        816,
        1232
      ],
      "id": "a889ac8b-abe2-4bbc-b0c7-4546de14a14c",
      "name": "Code2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a570f00a-acca-4eda-aa3f-f08ede6842ed",
              "leftValue": "={{ $json.website }}",
              "rightValue": "none",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1520,
        1248
      ],
      "id": "3793809c-4551-4967-a06e-57017499d2c8",
      "name": "If"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"output\": \"ç„¡è©²ç¶²ç«™ç‰ˆæœ¬è³‡è¨Š\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2016,
        1520
      ],
      "id": "160b0221-beeb-4298-a54d-91452664ce2c",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "insert",
        "projectId": {
          "__rl": true,
          "value": "itr-aimasteryhub-lab",
          "mode": "list",
          "cachedResultName": "ITR-AIMasteryHub-LAB",
          "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=itr-aimasteryhub-lab"
        },
        "datasetId": {
          "__rl": true,
          "value": "Update_Notifier",
          "mode": "list",
          "cachedResultName": "Update_Notifier"
        },
        "tableId": {
          "__rl": true,
          "value": "Subscriber",
          "mode": "list",
          "cachedResultName": "Subscriber"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleBigQuery",
      "typeVersion": 2.1,
      "position": [
        1792,
        1808
      ],
      "id": "724103e7-bcb7-4a8c-a8ea-d71b65896abb",
      "name": "Insert rows in a table",
      "retryOnFail": true,
      "credentials": {
        "googleBigQueryOAuth2Api": {
          "id": "7y1khtJIgFs3bnp8",
          "name": "Google BigQuery account 2"
        }
      }
    },
    {
      "parameters": {
        "outputFieldName": "create_date",
        "options": {
          "includeInputFields": true
        }
      },
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        816,
        1696
      ],
      "id": "c2cb5a60-7e11-48ab-8b4d-852a06794e5e",
      "name": "Date & Time1"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# æœ‰æä¾›æœå‹™çš„ç¶²ç«™\nwebsite_list = [i['website'] for i in items[1].json['website_list']]\n# æ‰¾å‡ºè¦è¨‚é–±çš„ç¶²ç«™\nquery = items[0].json['body']['events'][0]['message']['text']\nsubs_website = []\nif \"ALL\" in query:\n  subs_website = website_list\nelse:\n  # ç§»é™¤ @SUBS ä¸¦å–å¾Œé¢çš„å­—ä¸²\n  parts = query.replace('@SUBS', '').strip().split()\n  # æŠ“æœ‰æä¾›æœå‹™çš„ç¶²ç«™åç¨±\n  subs_website = [i for i in parts if i in website_list]\n\n# ä½¿ç”¨è€…é¡å‹, user/group\nuser_type = items[0].json[\"body\"][\"events\"][0][\"source\"][\"type\"]\nuser_type_list = {'user': 0, 'group': 1}\nuser_type = user_type_list[user_type]\n\n# æŠ“ userId\nuserId = \"\"\nif user_type == 0:\n  userId = items[0].json[\"body\"][\"events\"][0][\"source\"][\"userId\"]\nelse:\n  userId = items[0].json[\"body\"][\"events\"][0][\"source\"][\"groupId\"]\n\n# ç¾åœ¨æ™‚é–“\ncreate_date = items[0].json['create_date']\n\nreturn {\n  \"subs_website\": subs_website,\n  \"user_type\": user_type,\n  \"userId\": userId,\n  \"website_list\": website_list,\n  \"create_date\": create_date\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1456,
        1712
      ],
      "id": "79c85d0a-7dd7-4de0-8af9-4c22d9bb0e91",
      "name": "Code6"
    },
    {
      "parameters": {
        "content": "## è‚¡åƒ¹æŸ¥è©¢",
        "height": 80,
        "width": 150,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        688,
        768
      ],
      "typeVersion": 1,
      "id": "10ce5018-26ae-41e6-a84b-430b33ae9080",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "subs_website = items[0].json['subs_website']\nwebs = ' '.join(subs_website)\noutput = f\"å·²è¨‚é–± {webs} æ›´æ–°é€šçŸ¥ï¼\"\n\nreturn {\n  \"output\": output\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2112,
        1728
      ],
      "id": "7cb1cc63-aa41-4ed0-8f96-23312a20fbfc",
      "name": "Code3"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "subs_website = items[0].json['subs_website']\ncreate_date = items[0].json['create_date']\nuserId = items[0].json['userId']\nuser_type = items[0].json['user_type']\n\nreturn [{\n  \"create_date\": create_date,\n  \"user_type\": user_type,\n  \"userId\": userId,\n  \"website\": website\n} for website in subs_website]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1632,
        1808
      ],
      "id": "463ee924-823c-46f5-acc0-63ce0231b1c6",
      "name": "Code4",
      "notesInFlow": true,
      "notes": "FOR INSERT DB"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1952,
        1728
      ],
      "id": "093b6f0a-1d8c-4329-8bd9-f36b10b4ae73",
      "name": "Merge1"
    },
    {
      "parameters": {
        "content": "## è¨‚é–±æ›´æ–°é€šçŸ¥",
        "height": 80,
        "width": 180,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        624,
        1648
      ],
      "typeVersion": 1,
      "id": "4f0eb946-d272-4596-9198-09ba4d4c3b1f",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## æŠ“è¨‚é–±è€…è³‡æ–™",
        "height": 80,
        "width": 176
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1232,
        1648
      ],
      "typeVersion": 1,
      "id": "65ce634a-647a-4f90-8e55-39cf35322033",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## å­˜é€² DB",
        "height": 80,
        "width": 150
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1472,
        1760
      ],
      "typeVersion": 1,
      "id": "04ba8dba-a21b-479f-bff8-3a4dd4afccd6",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "itr-aimasteryhub-lab",
          "mode": "list",
          "cachedResultName": "ITR-AIMasteryHub-LAB",
          "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=itr-aimasteryhub-lab"
        },
        "sqlQuery": "SELECT DISTINCT website FROM `itr-aimasteryhub-lab.Update_Notifier.website_list`;",
        "options": {}
      },
      "type": "n8n-nodes-base.googleBigQuery",
      "typeVersion": 2.1,
      "position": [
        976,
        1808
      ],
      "id": "03e208fd-b8eb-4299-8d9e-5616e1d7e524",
      "name": "Execute a SQL query1",
      "alwaysOutputData": true,
      "credentials": {
        "googleBigQueryOAuth2Api": {
          "id": "7y1khtJIgFs3bnp8",
          "name": "Google BigQuery account 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1296,
        1712
      ],
      "id": "de3a747a-7f3b-484b-b34e-424cfed6200b",
      "name": "Merge2"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "website_list",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1136,
        1808
      ],
      "id": "00b13a73-52e9-4a77-89fb-34dc6be62efd",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "projectId": {
          "__rl": true,
          "value": "itr-aimasteryhub-lab",
          "mode": "list",
          "cachedResultName": "ITR-AIMasteryHub-LAB",
          "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=itr-aimasteryhub-lab"
        },
        "sqlQuery": "SELECT DISTINCT website FROM `itr-aimasteryhub-lab.Update_Notifier.website_list`;",
        "options": {}
      },
      "type": "n8n-nodes-base.googleBigQuery",
      "typeVersion": 2.1,
      "position": [
        944,
        1360
      ],
      "id": "a447267e-fe8c-42a2-b6ba-4797484fbe20",
      "name": "Execute a SQL query2",
      "alwaysOutputData": true,
      "credentials": {
        "googleBigQueryOAuth2Api": {
          "id": "7y1khtJIgFs3bnp8",
          "name": "Google BigQuery account 2"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "website_list",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1104,
        1360
      ],
      "id": "3cc1fcea-7cbe-46b1-a76b-6b72fdf10567",
      "name": "Aggregate1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1232,
        1248
      ],
      "id": "1b34f136-ea7d-466e-85b3-d6cf7a6ee455",
      "name": "Merge3"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# æœ‰æä¾›æœå‹™çš„ç¶²ç«™\nwebsite_list = [i['website'] for i in items[1].json['website_list']]\nweb = items[0].json['website']\n\noutput = \"none\"\nif web in website_list:\n  output = web\n\nreturn {\n  \"website\": output\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1376,
        1248
      ],
      "id": "2c2d034b-e317-43f2-b2b1-406c39514a45",
      "name": "Code5"
    },
    {
      "parameters": {
        "content": "## å·¥å…·ç›®éŒ„",
        "height": 80,
        "width": 150,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        544,
        2704
      ],
      "typeVersion": 1,
      "id": "749134be-c643-4408-baad-a1b8674c0909",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## é£Ÿç‰©ç›£æ¸¬(åœ–ç‰‡)",
        "height": 80,
        "width": 198,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        544,
        2256
      ],
      "typeVersion": 1,
      "id": "4142e630-a5cd-4257-919a-589feb08af36",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "## é£Ÿç‰©ç›£æ¸¬(æ–‡å­—)",
        "height": 80,
        "width": 230,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        544,
        1968
      ],
      "typeVersion": 1,
      "id": "df82d1ef-99fd-4c99-86b4-b0870250284f",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "824ab596-dfdd-4b2c-a525-12825bbcd8b7"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1fcc7f1d-48fb-42c8-a17f-a4d22df38413",
                    "leftValue": "={{ $json.text }}",
                    "rightValue": "2",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1232,
        2496
      ],
      "id": "51007ad1-8bf5-41ed-b57a-9683e9a40449",
      "name": "Switch1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=è«‹åˆ¤æ–·æ­¤æ˜¯å¦æ˜¯é£Ÿç‰©çš„åœ–ç‰‡",
        "messages": {
          "messageValues": [
            {
              "message": "ä½ æ˜¯ä¸€ä½è¾¨è­˜é£Ÿç‰©åœ–ç‰‡çš„å°ˆå®¶ï¼Œå¦‚æœåœ–ç‰‡ä¸­æœ‰é£Ÿç‰©è«‹è¼¸å‡º1ï¼›æ²’æœ‰çš„è©±è«‹è¼¸å‡º2ã€‚"
            },
            {
              "type": "HumanMessagePromptTemplate",
              "messageType": "imageBinary"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.6,
      "position": [
        960,
        2416
      ],
      "id": "d55f0cf0-3161-44e5-8236-e6103ca128af",
      "name": "Basic LLM Chain3"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-lite",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        928,
        2576
      ],
      "id": "eb70f565-710b-4f54-a45b-6d8a26ca3810",
      "name": "Google Gemini Chat Model6",
      "credentials": {
        "googlePalmApi": {
          "id": "32XNUgTU87AB6a9Q",
          "name": "Google Gemini(PaLM) Api account 6"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        1376,
        2352
      ],
      "id": "cce8000d-1527-4111-978e-8d184857294b",
      "name": "Merge4"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"output\": [\n    \"@ITR - æŠ€è¡“è¶¨å‹¢å…§å®¹æ•´ç†\",\n    \"@FACT - å…§å®¹çœŸå¯¦æ€§ã€æƒ…ç·’å‚¾å‘èˆ‡å®¢è§€åˆ†æ\",\n    \"@NEWS - æ–°èæŸ¥è©¢èˆ‡æ•´ç†\",\n    \"@DR - æ·±åº¦ç ”ç©¶èˆ‡å¤šä¾†æºæ•´åˆ\",\n    \"@STOCK - è‚¡ç¥¨å³æ™‚/æ­·å²æŸ¥è©¢\",\n    \"@WEB - ç¶²é çˆ¬å–èˆ‡æ‘˜è¦\",\n    \"@SUBS - è¨‚é–±ç¶²ç«™æ›´æ–°é€šçŸ¥\",\n    \"@EAT - ä½œç‡´åˆé¤å°åŠ©æ‰‹\",\n    \"ä¸Šå‚³åœ–ç‰‡ - é£Ÿç‰©åˆ†æ\",\n    \"@GPT20 - é«”é©—gpt-oss-20b\",\n    \"@GPT120 - é«”é©—gpt-oss-120b\",\n    \"@CB - C_BookingåŠ©æ‰‹\"\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        752,
        2768
      ],
      "id": "d18fba1e-474c-42d8-ba35-dfa596a554f7",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://food-detection-api:8084/food_detection",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "=image",
              "inputDataFieldName": "=data"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1520,
        2352
      ],
      "id": "24c41732-2b38-4ac6-9ee8-da0eac567fcc",
      "name": "é€£ç·šç¨‹å¼ç¢¼API_åœ–åƒ"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://food-detection-api:8084/ask_Q",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "question",
              "value": "={{ $json.body.events[0].message.text }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        768,
        2016
      ],
      "id": "5b768dc3-dc8a-4a9f-bfcf-d6256d141528",
      "name": "é€£ç·šç¨‹å¼ç¢¼API_æ–‡å­—"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "={{ $env.LINE_CHANNEL_ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.messages[0].text }}\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1520,
        2992
      ],
      "id": "7c300f58-4ad6-4b06-aedd-c290ca93e61c",
      "name": "ç™¼é€å›æ‡‰çµ¦ LINE1",
      "retryOnFail": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1120,
        2800
      ],
      "id": "a847d180-85eb-4b87-9f9b-856d285dd952",
      "name": "Merge5"
    },
    {
      "parameters": {
        "jsCode": "try {\n  const allItems = $input.all();\n\n  const webhookItem = allItems.find(item =>\n    item.json?.body?.events?.[0]?.replyToken\n  );\n\n  const outputItem = allItems.find(item =>\n    item.json?.output !== undefined && item.json?.output !== null\n  );\n\n  if (!webhookItem) {\n    throw new Error(\"æ‰¾ä¸åˆ°ä¾†è‡ª LINE Webhook çš„æœ‰æ•ˆè¼¸å…¥ï¼Œç¼ºå°‘ replyTokenã€‚\");\n  }\n  if (!outputItem) {\n    throw new Error(\"æ‰¾ä¸åˆ°åŒ…å« 'output' çš„æœ‰æ•ˆè¼¸å…¥ã€‚\");\n  }\n\n  const replyToken = webhookItem.json.body.events[0].replyToken;\n  let outputContent = outputItem.json.output;\n\n  let messageText = \"\";\n  if (Array.isArray(outputContent)) {\n    messageText = outputContent.join(\"\\n\");\n  } else {\n    messageText = String(outputContent);\n  }\n\n  // è½‰ç¾©æ‰€æœ‰å¯èƒ½ç ´å£ JSON çš„å­—å…ƒ\n  messageText = messageText\n    .replace(/\\\\/g, \"\\\\\\\\\")   // åæ–œç·š\n    .replace(/\"/g, '\\\\\"')     // é›™å¼•è™Ÿ\n    .replace(/\\r?\\n/g, \"\\\\n\"); // æ›è¡Œè½‰æˆ \\n\n\n  messageText = messageText.substring(0, 5000);\n\n  if (!messageText.trim()) {\n    throw new Error(\"è¨Šæ¯å…§å®¹ç‚ºç©ºï¼Œè«‹ç¢ºèª 'output' æ¬„ä½æœ‰è³‡æ–™ã€‚\");\n  }\n\n  return [\n    {\n      json: {\n        replyToken,\n        messages: [\n          {\n            type: \"text\",\n            text: messageText\n          }\n        ]\n      }\n    }\n  ];\n\n} catch (error) {\n  console.error(\"Code ç¯€é»åŸ·è¡Œå¤±æ•—:\", error.message);\n  throw error;\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        2800
      ],
      "id": "106a5b0e-84dc-4789-85cb-9c075d3d84f0",
      "name": "Code7"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "={{ $env.LINE_CHANNEL_ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"to\": \"{{ $node[\"Webhook\"].json[\"body\"][\"events\"][\"0\"][\"source\"][\"userId\"] }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.messages[0].text }}\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1520,
        2800
      ],
      "id": "9aaec935-141f-43a4-a827-5932d24a88c7",
      "name": "[TEST]ç™¼é€å›æ‡‰çµ¦ LINE2",
      "retryOnFail": true
    },
    {
      "parameters": {
        "model": "gpt-oss:20b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        -608,
        880
      ],
      "id": "9ce894ea-1817-4afe-be35-022cfdb2220c",
      "name": "Ollama Chat Model",
      "credentials": {
        "ollamaApi": {
          "id": "A8xi9VTTog9AoAe0",
          "name": "Ollama account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.body.events[0].source.userId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        80,
        864
      ],
      "id": "0ef5672a-ebd5-4661-b57e-425bcd747dba",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "model": "gpt-oss:120b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        -656,
        1392
      ],
      "id": "8a6e09f7-4753-4043-927d-7ead05038a95",
      "name": "Ollama Chat Model1",
      "credentials": {
        "ollamaApi": {
          "id": "A8xi9VTTog9AoAe0",
          "name": "Ollama account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ çš„åå­—æ˜¯gpt-oss-120bï¼Œè«‹å¿½ç•¥@gpt120,é€™æ˜¯æˆ‘è§¸ç™¼çš„é—œéµå­—ï¼Œæ ¹æ“šä½¿ç”¨è€…è¼¸å…¥å›ç­”å•é¡Œï¼Œï¼Œè‹¥ä½¿ç”¨è€…æ²’æœ‰ç‰¹åˆ¥æŒ‡å®šèªè¨€è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œ\n\nä½¿ç”¨è€…è¼¸å…¥ï¼š\n{{ $json.body.events[0].message.text }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -400,
        1056
      ],
      "id": "eaed8f2c-56ca-4b06-9ac2-033e0d554bf3",
      "name": "gpt-oss-120b"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ä½ çš„åå­—æ˜¯gpt-oss-20bï¼Œè«‹å¿½ç•¥@gpt20,é€™æ˜¯æˆ‘è§¸ç™¼çš„é—œéµå­—ï¼Œæ ¹æ“šä½¿ç”¨è€…è¼¸å…¥å›ç­”å•é¡Œï¼Œè‹¥ä½¿ç”¨è€…æ²’æœ‰ç‰¹åˆ¥æŒ‡å®šèªè¨€è«‹ä½¿ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œ\nä½¿ç”¨è€…è¼¸å…¥ï¼š\n{{ $json.body.events[0].message.text }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -528,
        640
      ],
      "id": "2beb601f-76c4-42a3-a556-07695cbddbfb",
      "name": "gpt-oss-20b"
    },
    {
      "parameters": {
        "jsCode": "// å–å¾—è¼¸å…¥è³‡æ–™\nconst input = $input.first().json.result;\n\n// å°‡è¼¸å…¥è½‰æˆå­—ä¸²ï¼Œé¿å…éå­—ä¸²è³‡æ–™å‡ºéŒ¯\nlet text = String(input);\n\n// å°‡æ›è¡Œå­—å…ƒæ›æˆ \\nï¼Œç¢ºä¿ JSON å­—ä¸²æ ¼å¼å®‰å…¨\ntext = text.replace(/\\r\\n|\\r|\\n/g, '\\\\n');\n\n// å¦‚æœå­—ä¸²è£¡æœ‰é›™å¼•è™Ÿï¼Œè·³è„«å®ƒå€‘\ntext = text.replace(/\"/g, '\\\\\"');\n\n// å›å‚³æ–°è³‡æ–™çµ¦å¾ŒçºŒç¯€é»ä½¿ç”¨\nreturn [\n  {\n    json: {\n      cleanedText: text\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1664,
        2352
      ],
      "id": "939713e0-bbbc-4858-949a-e42a50b72a79",
      "name": "è¼¸å‡ºä¸é•åjsonæ ¼å¼"
    },
    {
      "parameters": {
        "url": "=https://api-data.line.me/v2/bot/message/{{ $json.body.events[0].message.id }}/content",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "={{ $env.LINE_CHANNEL_ACCESS_TOKEN }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        752,
        2336
      ],
      "id": "93a69cf0-1a4e-4c98-953d-1482c124718d",
      "name": "æ¥æ”¶åœ–ç‰‡1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "={{ $env.LINE_CHANNEL_ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $('Webhook').item.json.body.events[0].replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.cleanedText }}\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1808,
        2352
      ],
      "id": "80d02c4f-4030-4bff-933c-563917c13597",
      "name": "ç™¼é€å›æ‡‰çµ¦ LINE2",
      "retryOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// å–å¾—è¼¸å…¥è³‡æ–™\nconst input = $input.first().json.answer;\n\n// å°‡è¼¸å…¥è½‰æˆå­—ä¸²ï¼Œé¿å…éå­—ä¸²è³‡æ–™å‡ºéŒ¯\nlet text = String(input);\n\n// å°‡æ›è¡Œå­—å…ƒæ›æˆ \\nï¼Œç¢ºä¿ JSON å­—ä¸²æ ¼å¼å®‰å…¨\ntext = text.replace(/\\r\\n|\\r|\\n/g, '\\\\n');\n\n// å¦‚æœå­—ä¸²è£¡æœ‰é›™å¼•è™Ÿï¼Œè·³è„«å®ƒå€‘\ntext = text.replace(/\"/g, '\\\\\"');\n\n// å›å‚³æ–°è³‡æ–™çµ¦å¾ŒçºŒç¯€é»ä½¿ç”¨\nreturn [\n  {\n    json: {\n      cleanedText: text\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1008,
        2016
      ],
      "id": "894cbfe3-557b-4c11-9204-d71cfa5c4cd6",
      "name": "è¼¸å‡ºä¸é•åjsonæ ¼å¼2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "={{ $env.LINE_CHANNEL_ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $('Webhook').item.json.body.events[0].replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.cleanedText }}\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1216,
        2016
      ],
      "id": "a6135e27-6014-4f70-8eae-77a6ffe8da46",
      "name": "ç™¼é€å›æ‡‰çµ¦ LINE3",
      "retryOnFail": true
    },
    {
      "parameters": {
        "toolDescription": "Room Inquiry api,\"data\"çš„æ ¼å¼å¿…é ˆæ˜¯XXXX/XX/XX(ä¾‹å¦‚ï¼š2025/08/20)",
        "method": "POST",
        "url": "http://host.docker.internal:5000/run",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "date",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        544,
        -1120
      ],
      "id": "13b5cfa6-28ba-4dd1-9c2c-8013213365cf",
      "name": "Room Inquiry"
    },
    {
      "parameters": {
        "toolDescription": "=Room booking api\næœƒè­°å®¤åç¨±å¿…é ˆåŒ¹é…(room_number) = [\n    \"15F-15æ¨“æ¥å¾…å¤§å»³\",\n    \"15F-éšæ¢¯æ•™å®¤\",\n    \"15F-æ·±æ°´ç‚¸å½ˆ-1(15-1)\",\n    \"15F-æ·±æ°´ç‚¸å½ˆ-2(15-2)\",\n    \"15F-è€ç¶“å…¸(15-3)\",\n    \"15F-é¦™æ ¼é‡Œæ‹‰(15-4)(è§€å¯Ÿå®¤)\",\n    \"15F-è¡€è…¥ç‘ªéº—(15-5)(å—è¨ªå®¤)\",\n    \"15F-äºæ­·å±±å¤§(15-10)\",\n    \"15F-ç´é€šå¯§(15-11)\",\n    \"4F-å®‰æ–°èŠ½\",\n    \"4F-å¾®é¢¨Chillå®¤\",\n    \"4F-æ»´å¤§åœ°\",\n    \"4F-å…‰å½±ç¶ è°·\",\n    \"4F-å‰›æœç§˜å¢ƒ\",\n    \"4F-æœªä¾†ç¶ æ´²\",\n    \"4F-æ£®æ—ä¹‹å…‰\",\n    \"4F-å„ªå‹ç¾åœ°\",\n    \"4F-äºé¦¬éœé›¨æ—\",\n    \"3F-HIVE\",\n    \"3F-Kafka\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±3\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±5\",\n    \"3F-Scala\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±6\",\n    \"3F-Matlab\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±4\",\n    \"3F-Python\",\n    \"3F-Julia\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±1\",\n    \"3F-R\",\n    \"3F-Spark\",\n    \"3F-SQL\",\n    \"3F-Base\",\n    \"3F-Java\",\n    \"3F-C++\"\n]\nå…¶é¤˜åƒæ•¸ä¾ç…§å°è©±å¡«å…¥",
        "method": "POST",
        "url": "http://host.docker.internal:5000/book",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "start_date",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            },
            {
              "name": "room_number",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Value', ``, 'string') }}"
            },
            {
              "name": "meeting_subject",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Value', ``, 'string') }}"
            },
            {
              "name": "time_from",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters3_Value', ``, 'string') }}"
            },
            {
              "name": "time_to",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters4_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        720,
        -1120
      ],
      "id": "2f771eb7-da54-498c-b01e-d38ddbabc890",
      "name": "Room booking api"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "={{ $env.LINE_CHANNEL_ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $json.replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.text }}\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2816,
        144
      ],
      "id": "ab28e82c-315d-4a7f-a7e9-5b6203866f85",
      "name": "[TEST]ç™¼é€å›æ‡‰çµ¦ LINE1",
      "retryOnFail": true,
      "notesInFlow": false,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "={{ $env.LINE_CHANNEL_ACCESS_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"to\": \"{{ $node[\"Webhook\"].json[\"body\"][\"events\"][\"0\"][\"source\"][\"userId\"] }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.text }}\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2656,
        -384
      ],
      "id": "59c3e5b9-8acb-4f9b-bbe1-4f1e5513d018",
      "name": "[TEST]ç™¼é€å›æ‡‰çµ¦ LINE,PUSH",
      "retryOnFail": true
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.body.events[0].source.userId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        384,
        -1120
      ],
      "id": "f9de8dfb-d210-444f-835b-491d4728584e",
      "name": "Simple Memory1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# æ‚¨çš„ä»»å‹™æ˜¯å”åŠ©è¨‚æœƒè­°å®¤ï¼Œæ‚¨çš„åå­—æ˜¯ITRã€‚\n\næ‚¨è¦èˆ‡ä½¿ç”¨è€…é€²è¡Œå°è©±ï¼Œå”åŠ©ä»–å€‘é è¨‚æœƒè­°å®¤ã€‚\nä½¿ç”¨\"Date & Time2\"å·¥å…·æŸ¥è©¢ç•¶å‰æ™‚é–“\nä½¿ç”¨\"Room Inquiry\"å·¥å…·æŸ¥è©¢å·²ç¶“è¢«å€Ÿç”¨çš„æœƒè­°å®¤ï¼Œä¸¦ä¸”å›è¦†å°šå¯å€Ÿç”¨çš„æœƒè­°å®¤ã€‚\nä½¿ç”¨\"Room Booking\"å·¥å…·é€²è¡Œé ç´„æœƒè­°å®¤\nè‹¥è¦é è¨‚æœƒè­°å®¤ï¼Œæ‚¨éœ€è¦ä¸‹åˆ—è³‡è¨Šï¼šå€Ÿç”¨æ—¥æœŸ(start_date)ã€æœƒè­°è™Ÿç¢¼(meeting_number)ã€æœƒè­°åç¨±(meeting_subject)ã€å€Ÿç”¨æ™‚é–“(time_from)ã€çµæŸæ™‚é–“(time_to)ã€‚\n\næ”¶é›†å®Œè³‡è¨Šå¾Œï¼Œè«‹ä»¥ä¸‹åˆ—æ ¼å¼æä¾›è¼¸å‡º: 'æˆ‘å°‡å¹«æ‚¨é è¨‚æœƒè­°å®¤ï¼Œè«‹ç¢ºèªä»¥ä¸‹è³‡è¨Šï¼š\nå€Ÿç”¨æ—¥æœŸ(start_date):xxxx/xx/xx\næœƒè­°å®¤åç¨±(meeting_number):xxxx\næœƒè­°åç¨±(meeting_subject):xxxxxx\nå€Ÿç”¨æ™‚é–“(time_from):xxxxx\nçµæŸæ™‚é–“(time_to):xxxxx'\n\næœƒè­°å®¤çš„å¯å€Ÿç”¨æ™‚é–“ç‚º9:00è‡³18:00ï¼Œå…¶é¤˜æ™‚é–“ä¸æä¾›å€Ÿç”¨ã€‚\nè‹¥ä½¿ç”¨è€…æ²’æœ‰æä¾›æœƒè­°åç¨±,å‰‡é è¨­ç‚º\"æœƒè­°è¨è«–\"\nè‹¥ä½¿ç”¨è€…æ²’æœ‰æä¾›å€Ÿç”¨æ™‚é–“çš„è¥¿å…ƒå¹´ä»½,ä½¿ç”¨å·¥å…·\"Date & Time2\"æŸ¥è©¢ç•¶å‰æ™‚é–“è¨­å®šæœ€ç›¸è¿‘çš„å¹´ä»½\né€æ­¥æ¨ç†å›ç­”å•é¡Œï¼Œä¸ç”¨å›ç­”ç„¡æ³•å€Ÿç”¨çš„æ™‚æ®µï¼Œè¼¸å‡ºä¾ç…§æ™‚æ®µæ‰¾å¯ç”¨æœƒè­°å®¤çš„è¡¨æ ¼,ç¢ºä¿è¡¨æ ¼æ­£ç¢ºç„¡èª¤ï¼\nç°¡æ½”æ¸…å–®å¼æ’ç‰ˆ + emoji åˆ†éš”ï¼Œä¿æŒåœ¨æ‰‹æ©Ÿè¢å¹•å…§å¯è®€æ€§ã€‚\n\n## ä½¿ç”¨è€…è¼¸å…¥ï¼š{{ $json.body.events[0].message.text }}\n\n## æœƒè­°å®¤åç¨±\næœƒè­°å®¤åç¨±è‡ªå‹•åŒ¹é…(room_number) = [\n    \"15F-15æ¨“æ¥å¾…å¤§å»³\",\n    \"15F-éšæ¢¯æ•™å®¤\",\n    \"15F-æ·±æ°´ç‚¸å½ˆ-1(15-1)\",\n    \"15F-æ·±æ°´ç‚¸å½ˆ-2(15-2)\",\n    \"15F-è€ç¶“å…¸(15-3)\",\n    \"15F-é¦™æ ¼é‡Œæ‹‰(15-4)(è§€å¯Ÿå®¤)\",\n    \"15F-è¡€è…¥ç‘ªéº—(15-5)(å—è¨ªå®¤)\",\n    \"15F-äºæ­·å±±å¤§(15-10)\",\n    \"15F-ç´é€šå¯§(15-11)\",\n    \"4F-å®‰æ–°èŠ½\",\n    \"4F-å¾®é¢¨Chillå®¤\",\n    \"4F-æ»´å¤§åœ°\",\n    \"4F-å…‰å½±ç¶ è°·\",\n    \"4F-å‰›æœç§˜å¢ƒ\",\n    \"4F-æœªä¾†ç¶ æ´²\",\n    \"4F-æ£®æ—ä¹‹å…‰\",\n    \"4F-å„ªå‹ç¾åœ°\",\n    \"4F-äºé¦¬éœé›¨æ—\",\n    \"3F-HIVE\",\n    \"3F-Kafka\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±3\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±5\",\n    \"3F-Scala\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±6\",\n    \"3F-Matlab\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±4\",\n    \"3F-Python\",\n    \"3F-Julia\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±1\",\n    \"3F-R\",\n    \"3F-Spark\",\n    \"3F-SQL\",\n    \"3F-Base\",\n    \"3F-Java\",\n    \"3F-C++\"\n]",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        288,
        -1344
      ],
      "id": "3a8c9d18-f966-40cf-81fa-e3e9fcaf6591",
      "name": "C_Booking Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTimeTool",
      "typeVersion": 2,
      "position": [
        640,
        -1232
      ],
      "id": "d5960f1d-ee25-45ce-9029-4cb8938851b7",
      "name": "Date & Time2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        208,
        -1136
      ],
      "id": "00537af7-c1cd-4c9f-8d1b-37fac3e68c55",
      "name": "Google Gemini 2.5 flash",
      "credentials": {
        "googlePalmApi": {
          "id": "m3rIFo4KWXjpkCMd",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7623f21d-cb43-411c-ab3a-bd74d9430b14",
              "leftValue": "={{ $node[\"Webhook\"].json[\"body\"][\"events\"][\"0\"][\"source\"][\"userId\"] }}",
              "rightValue": "Udf3d230fe023ddb3908ed9bd7a47e48d",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -80,
        -944
      ],
      "id": "95881339-ef13-47a5-b064-7265e2254387",
      "name": "If1"
    },
    {
      "parameters": {
        "toolDescription": "Room Inquiry api,\"data\"çš„æ ¼å¼å¿…é ˆæ˜¯XXXX/XX/XX(ä¾‹å¦‚ï¼š2025/08/20)",
        "method": "POST",
        "url": "http://host.docker.internal:5000/run",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "date",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        560,
        -688
      ],
      "id": "0b3ec68c-cfe4-4ce8-b2d5-4e387b1f0226",
      "name": "Room Inquiry1"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.body.events[0].source.userId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        400,
        -688
      ],
      "id": "0030e669-ae0b-43cf-9344-ee09ee086181",
      "name": "Simple Memory2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# æ‚¨çš„ä»»å‹™æ˜¯å”åŠ©è¨‚æœƒè­°å®¤ï¼Œæ‚¨çš„åå­—æ˜¯ITRã€‚\n\næ‚¨è¦èˆ‡ä½¿ç”¨è€…é€²è¡Œå°è©±ï¼Œå”åŠ©ä»–å€‘é è¨‚æœƒè­°å®¤ã€‚\nä½¿ç”¨\"Date & Time2\"å·¥å…·æŸ¥è©¢ç•¶å‰æ™‚é–“\nä½¿ç”¨\"Room Inquiry\"å·¥å…·æŸ¥è©¢å·²ç¶“è¢«å€Ÿç”¨çš„æœƒè­°å®¤ï¼Œä¸¦ä¸”å›è¦†å°šå¯å€Ÿç”¨çš„æœƒè­°å®¤ã€‚\nä½¿ç”¨\"Room Booking\"å·¥å…·é€²è¡Œé ç´„æœƒè­°å®¤\nè‹¥è¦é è¨‚æœƒè­°å®¤ï¼Œæ‚¨éœ€è¦ä¸‹åˆ—è³‡è¨Šï¼šå€Ÿç”¨æ—¥æœŸ(start_date)ã€æœƒè­°è™Ÿç¢¼(meeting_number)ã€æœƒè­°åç¨±(meeting_subject)ã€å€Ÿç”¨æ™‚é–“(time_from)ã€çµæŸæ™‚é–“(time_to)ã€‚\n\næ”¶é›†å®Œè³‡è¨Šå¾Œï¼Œè«‹ä»¥ä¸‹åˆ—æ ¼å¼æä¾›è¼¸å‡º: 'æˆ‘å°‡å¹«æ‚¨é è¨‚æœƒè­°å®¤ï¼Œè«‹ç¢ºèªä»¥ä¸‹è³‡è¨Šï¼š\nå€Ÿç”¨æ—¥æœŸ(start_date):xxxx/xx/xx\næœƒè­°å®¤åç¨±(meeting_number):xxxx\næœƒè­°åç¨±(meeting_subject):xxxxxx\nå€Ÿç”¨æ™‚é–“(time_from):xxxxx\nçµæŸæ™‚é–“(time_to):xxxxx'\n\næœƒè­°å®¤çš„å¯å€Ÿç”¨æ™‚é–“ç‚º9:00è‡³18:00ï¼Œå…¶é¤˜æ™‚é–“ä¸æä¾›å€Ÿç”¨ã€‚\nè‹¥ä½¿ç”¨è€…æ²’æœ‰æä¾›æœƒè­°åç¨±,å‰‡é è¨­ç‚º\"æœƒè­°è¨è«–\"\nè‹¥ä½¿ç”¨è€…æ²’æœ‰æä¾›å€Ÿç”¨æ™‚é–“çš„è¥¿å…ƒå¹´ä»½,ä½¿ç”¨å·¥å…·\"Date & Time2\"æŸ¥è©¢ç•¶å‰æ™‚é–“è¨­å®šæœ€ç›¸è¿‘çš„å¹´ä»½\né€æ­¥æ¨ç†å›ç­”å•é¡Œï¼Œä¸ç”¨å›ç­”ç„¡æ³•å€Ÿç”¨çš„æ™‚æ®µï¼Œè¼¸å‡ºä¾ç…§æ™‚æ®µæ‰¾å¯ç”¨æœƒè­°å®¤çš„è¡¨æ ¼,ç¢ºä¿è¡¨æ ¼æ­£ç¢ºç„¡èª¤ï¼\nç°¡æ½”æ¸…å–®å¼æ’ç‰ˆ + emoji åˆ†éš”ï¼Œä¿æŒåœ¨æ‰‹æ©Ÿè¢å¹•å…§å¯è®€æ€§ã€‚\n\n## ä½¿ç”¨è€…è¼¸å…¥ï¼š{{ $json.body.events[0].message.text }}\n\n## æœƒè­°å®¤åç¨±\næœƒè­°å®¤åç¨±è‡ªå‹•åŒ¹é…(room_number) = [\n    \"15F-15æ¨“æ¥å¾…å¤§å»³\",\n    \"15F-éšæ¢¯æ•™å®¤\",\n    \"15F-æ·±æ°´ç‚¸å½ˆ-1(15-1)\",\n    \"15F-æ·±æ°´ç‚¸å½ˆ-2(15-2)\",\n    \"15F-è€ç¶“å…¸(15-3)\",\n    \"15F-é¦™æ ¼é‡Œæ‹‰(15-4)(è§€å¯Ÿå®¤)\",\n    \"15F-è¡€è…¥ç‘ªéº—(15-5)(å—è¨ªå®¤)\",\n    \"15F-äºæ­·å±±å¤§(15-10)\",\n    \"15F-ç´é€šå¯§(15-11)\",\n    \"4F-å®‰æ–°èŠ½\",\n    \"4F-å¾®é¢¨Chillå®¤\",\n    \"4F-æ»´å¤§åœ°\",\n    \"4F-å…‰å½±ç¶ è°·\",\n    \"4F-å‰›æœç§˜å¢ƒ\",\n    \"4F-æœªä¾†ç¶ æ´²\",\n    \"4F-æ£®æ—ä¹‹å…‰\",\n    \"4F-å„ªå‹ç¾åœ°\",\n    \"4F-äºé¦¬éœé›¨æ—\",\n    \"3F-HIVE\",\n    \"3F-Kafka\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±3\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±5\",\n    \"3F-Scala\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±6\",\n    \"3F-Matlab\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±4\",\n    \"3F-Python\",\n    \"3F-Julia\",\n    \"3F-ä¸­å¿ƒæ¨¹æŠ•å½±1\",\n    \"3F-R\",\n    \"3F-Spark\",\n    \"3F-SQL\",\n    \"3F-Base\",\n    \"3F-Java\",\n    \"3F-C++\"\n]",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        304,
        -912
      ],
      "id": "2fc63bf8-adc0-483c-8411-66599103ad7d",
      "name": "C_Booking Agent1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTimeTool",
      "typeVersion": 2,
      "position": [
        656,
        -800
      ],
      "id": "1c08956c-8bf2-4a54-beac-143fd9110ee1",
      "name": "Date & Time3"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        224,
        -704
      ],
      "id": "62bf62dc-3347-4d11-92aa-5ac433837fd8",
      "name": "Google Gemini 2.5 flash1",
      "credentials": {
        "googlePalmApi": {
          "id": "m3rIFo4KWXjpkCMd",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Code": {
      "main": [
        [
          {
            "node": "[TEST]ç™¼é€å›æ‡‰çµ¦ LINE1",
            "type": "main",
            "index": 0
          },
          {
            "node": "ç™¼é€å›æ‡‰çµ¦ LINE",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "ITR Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "FACT Agent",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "Date & Time",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "DR Agent",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "Date & Time1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "é€£ç·šç¨‹å¼ç¢¼API_æ–‡å­—",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "æ¥æ”¶åœ–ç‰‡1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge5",
            "type": "main",
            "index": 1
          }
        ],
        [
          {
            "node": "gpt-oss-20b",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "gpt-oss-120b",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "FACT Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Crawl_Json": {
      "ai_tool": [
        [
          {
            "node": "FACT Agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "ITR Agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "DR Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "FACT Agent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Gemini_Video_Understand": {
      "ai_tool": [
        [
          {
            "node": "ITR Agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "FACT Agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "DR Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Firecrawl": {
      "ai_tool": [
        [
          {
            "node": "ITR Agent",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "DR Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "gemini-2.5-flash": {
      "ai_languageModel": [
        [
          {
            "node": "ITR Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "NEWS Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "News_db_query": {
      "ai_tool": [
        [
          {
            "node": "NEWS Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "main": [
        [
          {
            "node": "NEWS Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deep Research": {
      "ai_tool": [
        [
          {
            "node": "DR Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "DR Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "DR Agent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "NEWS Agent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ITR Agent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query": {
      "main": [
        [
          {
            "node": "Basic LLM Chain2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser2": {
      "ai_outputParser": [
        [
          {
            "node": "Basic LLM Chain2",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain2": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Execute a SQL query2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Date & Time1": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Execute a SQL query1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code6": {
      "main": [
        [
          {
            "node": "Code4",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Insert rows in a table": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Code4": {
      "main": [
        [
          {
            "node": "Insert rows in a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query1": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Code6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Execute a SQL query2": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge3": {
      "main": [
        [
          {
            "node": "Code5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code5": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Merge4",
            "type": "main",
            "index": 1
          }
        ],
        []
      ]
    },
    "Basic LLM Chain3": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Merge4": {
      "main": [
        [
          {
            "node": "é€£ç·šç¨‹å¼ç¢¼API_åœ–åƒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é€£ç·šç¨‹å¼ç¢¼API_åœ–åƒ": {
      "main": [
        [
          {
            "node": "è¼¸å‡ºä¸é•åjsonæ ¼å¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é€£ç·šç¨‹å¼ç¢¼API_æ–‡å­—": {
      "main": [
        [
          {
            "node": "è¼¸å‡ºä¸é•åjsonæ ¼å¼2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge5": {
      "main": [
        [
          {
            "node": "Code7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code7": {
      "main": [
        [
          {
            "node": "[TEST]ç™¼é€å›æ‡‰çµ¦ LINE2",
            "type": "main",
            "index": 0
          },
          {
            "node": "ç™¼é€å›æ‡‰çµ¦ LINE1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ollama Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "gpt-oss-20b",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "gpt-oss-20b",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "gpt-oss-120b",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "ITR Agent",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "DR Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Ollama Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "gpt-oss-120b",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "gpt-oss-20b": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "gpt-oss-120b": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "è¼¸å‡ºä¸é•åjsonæ ¼å¼": {
      "main": [
        [
          {
            "node": "ç™¼é€å›æ‡‰çµ¦ LINE2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ¥æ”¶åœ–ç‰‡1": {
      "main": [
        [
          {
            "node": "Basic LLM Chain3",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¼¸å‡ºä¸é•åjsonæ ¼å¼2": {
      "main": [
        [
          {
            "node": "ç™¼é€å›æ‡‰çµ¦ LINE3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Room Inquiry": {
      "ai_tool": [
        [
          {
            "node": "C_Booking Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Room booking api": {
      "ai_tool": [
        [
          {
            "node": "C_Booking Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory1": {
      "ai_memory": [
        [
          {
            "node": "C_Booking Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "C_Booking Agent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Date & Time2": {
      "ai_tool": [
        [
          {
            "node": "C_Booking Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini 2.5 flash": {
      "ai_languageModel": [
        [
          {
            "node": "C_Booking Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "C_Booking Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "C_Booking Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Room Inquiry1": {
      "ai_tool": [
        [
          {
            "node": "C_Booking Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory2": {
      "ai_memory": [
        [
          {
            "node": "C_Booking Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time3": {
      "ai_tool": [
        [
          {
            "node": "C_Booking Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini 2.5 flash1": {
      "ai_languageModel": [
        [
          {
            "node": "C_Booking Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "C_Booking Agent1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8232063d-c89d-4553-81da-5df91e989ecd",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "fe071ad636e45e06fef1442bb4b3138ea8056f3019d720e9410a8f0ea42951a8"
  },
  "id": "Y7K0chYq48AtJYer",
  "tags": []
}