{
  "name": "[SUB] NEWS Agent",
  "nodes": [
    {
      "parameters": {
        "description": "使用這個工具取得新聞文章，資料庫內包含的欄位有新聞的標題、發布時間、內文、網址，輸入以這些欄位為條件的自然語言指令。這個工具會將自然語言的需求轉換為 SQL 查詢，並回傳新聞文章的查詢結果。\n\n輸入範例：\n1. 列出今日所有的新聞標題\n2. 列出本週的新聞標題與內文與網址\n3. 列出這三天的新聞標題與內文與網址\n\n重要：\n- 這個工具不能產生摘要，只能回傳新聞文章陣列\n- 不要以「摘要⋯⋯」作為 natural_language_query",
        "workflowId": {
          "__rl": true,
          "value": "HAIIAhz50naJPpU4",
          "mode": "list",
          "cachedResultName": "LINE_CHATBOT_database_query_tool"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "natural_language_query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('natural_language_query', ``, 'string') }}"
          },
          "matchingColumns": [
            "natural_language_query"
          ],
          "schema": [
            {
              "id": "natural_language_query",
              "displayName": "natural_language_query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -176,
        192
      ],
      "id": "9fd193cf-11b6-4577-a990-9f62c7374cb8",
      "name": "News_db_query"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=使用工具\"Date & Time\",取得當前時間決定後續參數設定\n使用者輸入**「{{ $json.userInput }}」**",
        "options": {
          "systemMessage": "=## 📰 角色指令：新聞整理專家\n\n你是一位擅長資訊統整的新聞整理專家，負責根據使用者需求，回傳清晰、有組織的新聞資訊。  \n你可以使用內建的工具：新聞查詢工具**News_db_query**。\n\n### 📌 操作規則\n\n#### 1. 當使用者要求「摘要新聞」時：\n- 使用**News_db_query**主動查詢當前熱門或相關新聞，需要輸出新聞內文、來源網址。\n- 將查詢結果進行**整理與摘要**，強調重點與背景脈絡。\n- 如有多篇報導涉及相同主題，請：\n  - 整合內容，**避免重複**。\n  - 提供**完整、連貫的綜合摘要**，字可以稍多，100字內。\n  - 每篇報導後，附上來源網址\n\n#### 2. 當使用者要求「列出新聞標題」時：\n- 同樣使用**News_db_query**取得新聞文章。\n- 萃取所有標題，並根據**主題相似性進行分組**。\n- 為每一組提供**簡短的主題說明**，方便使用者快速掌握焦點。\n\n#### 3. 查詢新聞時的主動性：\n- **不要求使用者輸入新聞主題**。\n- 直接根據時事、熱門趨勢、關鍵字等，自行判斷查詢目標。\n- 保持主動性與智慧判斷，確保資訊的即時性與完整性。\n\n### 🧰 可用工具\n\n- `News_db_query`：可用來查找最新、相關新聞內容。\n\n### 格式優化指引\n- 使用表情符號增強視覺效果和可讀性\n- 適當運用分隔線和空行提升結構清晰度\n- 針對手機閱讀體驗優化排版\n- 確保內容完整且邏輯清楚\n\n### 輸出限制\n❌ 禁止使用：Markdown 語法（#、**、[]()等）\n❌ 禁止使用：HTML 標籤\n❌ 禁止輸出：處理過程說明或額外註解\n✅ 僅輸出：最終整理完成的內容總結\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -288,
        -48
      ],
      "id": "745f61b7-48c1-4340-9d0b-776dfc641638",
      "name": "NEWS Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.dateTimeTool",
      "typeVersion": 2,
      "position": [
        -32,
        192
      ],
      "id": "eac76e84-d9d5-4e00-b89a-768ab7c6afbb",
      "name": "Date & Time"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "userInput"
            },
            {
              "name": "url"
            },
            {
              "name": "userId"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -528,
        -48
      ],
      "id": "e476014a-ee47-46ea-af28-b50212ef406e",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-lite",
        "options": {
          "temperature": 0.4
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -352,
        176
      ],
      "id": "248b192d-cbec-4019-bed0-2cb55d6d7fb7",
      "name": "gemini-2.5-flash",
      "credentials": {
        "googlePalmApi": {
          "id": "m3rIFo4KWXjpkCMd",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "News_db_query": {
      "ai_tool": [
        [
          {
            "node": "NEWS Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "ai_tool": [
        [
          {
            "node": "NEWS Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "NEWS Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "gemini-2.5-flash": {
      "ai_languageModel": [
        [
          {
            "node": "NEWS Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "a13391ec-7b45-4b1f-8f5f-cc30f83bb6c5",
  "meta": {
    "instanceId": "fe071ad636e45e06fef1442bb4b3138ea8056f3019d720e9410a8f0ea42951a8"
  },
  "id": "8YQ5Dxn0lt0iaJ6G",
  "tags": [
    {
      "createdAt": "2025-08-21T02:49:05.390Z",
      "updatedAt": "2025-08-21T02:49:05.390Z",
      "id": "lygt6UVIOm5CiWbW",
      "name": "linebot"
    }
  ]
}